/*! angular-leaflet-directive 04-05-2013 */
var leafletDirective=angular.module("leaflet-directive",[]);leafletDirective.directive("leaflet",function(){return{restrict:"E",replace:!0,transclude:!0,scope:{center:"=center",tilelayer:"=tilelayer",markers:"=markers",paths:"=paths"},template:'<div class="angular-leaflet-map"></div>',link:function(e,t,n){var a=t[0],r=new L.Map(a),o=new L.LatLng(40.094882122321145,-3.8232421874999996);r.setView(o,1);var i=e.tilelayer||"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png";if(L.tileLayer(i,{maxZoom:12}).addTo(r),n.center){e.$watch("center",function(t){if(void 0!==t){t=new L.LatLng(e.center.lat,e.center.lng);var n=e.center.zoom||8;r.setView(t,n)}});var c=!1;r.on("dragstart",function(){c=!0}),r.on("drag",function(){e.$apply(function(e){e.center.lat=r.getCenter().lat,e.center.lng=r.getCenter().lng})}),r.on("dragend",function(){c=!1}),e.$watch("center.lng",function(e){c||r.setView(new L.LatLng(r.getCenter().lat,e),r.getZoom())}),e.$watch("center.lat",function(e){c||r.setView(new L.LatLng(e,r.getCenter().lng),r.getZoom())});var l=!1;r.on("zoomstart",function(){l=!0}),e.$watch("center.zoom",function(e){l||r.setZoom(e)}),r.on("zoomend",function(){void 0!==e.center&&void 0!==e.center.zoom&&(e.$apply(function(e){e.center.zoom=r.getZoom()}),l=!1)})}if(void 0!==n.markers){var g=[],s=function(e,t){var n=t.markers[e],a=new L.marker(t.markers[e],{draggable:n.draggable?!0:!1});if(n.message){var r=new L.Popup({closeButton:!1});r.setLatLng(new L.LatLng(n.lat,n.lng)),r.setContent(n.message),t.$watch("markers."+e+".message",function(){r.setContent(n.message)})}if(n.draggable){var o=!1;a.on("dragstart",function(){o=!0}),a.on("drag",function(){t.$apply(function(){n.lat=a.getLatLng().lat,n.lng=a.getLatLng().lng})}),a.on("dragend",function(){o=!1}),t.$watch("markers."+e,function(){a.setLatLng(t.markers[e])},!0)}return a};e.$watch("markers",function(){for(var t in g)e.markers[t]||r.removeLayer(g[t]);for(var n in e.markers)if(void 0===g[n]){var a=s(n,e);r.addLayer(a),g[n]=a}},!0)}if(n.mainpath){var m=new L.Polyline([],{});r.addLayer(m),e.$watch("mainPath",function(){m.setLatLngs(e.mainPath.latlngs),m.setStyle({smoothFactor:e.mainPath.smoothFactor,color:e.mainPath.color})},!0)}}}});