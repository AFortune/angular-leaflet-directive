/**!
 * The MIT License
 *
 * Copyright (c) 2013 the angular-leaflet-directive team, http://tombatossals.github.io/angular-leaflet-directive
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 *
 * angular-google-maps
 * https://github.com/tombatossals/angular-leaflet-directive
 *
 * @authors https://github.com/tombatossals/angular-leaflet-directive/graphs/contributors
 */

/*! angular-leaflet-directive 20-10-2013 */
!function(){"use strict";function a(a){return angular.isDefined(a)}function b(a){return angular.isNumber(a)}function c(b){var c=d();return a(b)&&(c.maxZoom=a(b.maxZoom)?parseInt(b.maxZoom,10):c.maxZoom,c.minZoom=a(b.minZoom)?parseInt(b.minZoom,10):c.minZoom,c.doubleClickZoom=a(b.doubleClickZoom)&&b.doubleClickZoom?!0:!1,c.scrollWheelZoom=a(b.scrollWheelZoom)&&b.scrollWheelZoom?!0:!1,c.attributionControl=a(b.attributionControl)&&b.attributionControl?!0:!1,c.tileLayer=a(b.tileLayer)?b.tileLayer:c.tileLayer,b.tileLayerOptions&&angular.copy(b.tileLayerOptions,c.tileLayerOptions)),c}function d(){return{maxZoom:14,minZoom:1,doubleClickZoom:!0,scrollWheelZoom:!0,zoomControl:!0,attributionControl:!0,zoomsliderControl:!1,controlLayersPosition:"topright",tileLayer:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",tileLayerOptions:{attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'},icon:{url:"http://cdn.leafletjs.com/leaflet-0.6.4/images/marker-icon.png",retinaUrl:"http://cdn.leafletjs.com/leaflet-0.6.4/images/marker-icon-2x.png",size:[25,41],anchor:[12,40],popup:[0,-40],shadow:{url:"http://cdn.leafletjs.com/leaflet-0.6.4/images/marker-shadow.png",retinaUrl:"http://cdn.leafletjs.com/leaflet-0.6.4/images/marker-shadow.png",size:[41,41],anchor:[12,40]}},path:{weight:10,opacity:1,color:"#0000ff"},center:{lat:0,lng:0,zoom:1}}}var e=angular.module("leaflet-directive",[]);e.directive("leaflet",["$http","$log","$parse","$rootScope",function(a,d,e){return{restrict:"E",replace:!0,transclude:!0,scope:{maxBounds:"=maxbounds",bounds:"=bounds",marker:"=marker",markers:"=markers",legend:"=legend",geojson:"=geojson",defaults:"=defaults",paths:"=paths",tiles:"=tiles",events:"=events",layers:"=layers",customControls:"=customControls",leafletMap:"=leafletmap",eventBroadcast:"=eventBroadcast"},template:'<div class="angular-leaflet-map"></div>',controller:["$scope",function(a){this.getMap=function(){return a.map}}],link:function(a,f,g){function h(b,c,d){var e,f=d.tileLayer,g=d.tileLayerOptions;angular.isDefined(c)&&(angular.isDefined(c.url)&&(f=c.url),angular.isDefined(c.options)&&angular.copy(c.options,g),a.watch("tiles.url",function(a){angular.isDefined(a)&&e.setUrl(a)})),e=L.tileLayer(f,g),e.addTo(b)}function i(){}function j(a,b){a.setView([b.lat,b.lng],b.zoom),i()}function k(a,b){return JSON.stringify(a)===JSON.stringify(b)}function l(a){return angular.isDefined(a)&&angular.isDefined(a.lat)&&angular.isDefined(a.lng)&&angular.isDefined(a.zoom)&&b(a.lat)&&b(a.lng)&&b(a.zoom)}function m(){var b=a.$root.$$phase;return!("$apply"===b||"$digest"===b)}function n(b){m()?a.$apply(b):a.$eval(b)}function o(c,f,g){if(!angular.isDefined(f))return d.warn("[AngularJS - Leaflet] 'center' is undefined in the current scope, did you forget to initialize it?"),j(c,g.center),void 0;b(f.lat)&&b(f.lng)&&b(f.zoom)?j(c,f):f.autoDiscover===!0?c.locate({setView:!0,maxZoom:g.maxZoom}):(d.warn("[AngularJS - Leaflet] 'center' is incorrect"),j(c,g.center));var h={lat:e("center.lat"),lng:e("center.lng"),zoom:e("center.zoom")},m=!1;a.$watch("center",function(a,b){return l(a)?(m||k(a,b)||j(c,a),void 0):(d.warn("[AngularJS - Leaflet] invalid 'center'"),j(c,g.center),void 0)},!0),c.on("movestart",function(){m=!0}),c.on("moveend",function(){m=!1,n(function(a){h&&(h.lat.assign(a,c.getCenter().lat),h.lng.assign(a,c.getCenter().lng),h.zoom.assign(a,c.getZoom())),i()})})}var p=c(a.defaults);a.maxBounds&&(p.minZoom=void 0),g.width&&(isNaN(g.width)?f.css("width",g.width):f.css("width",g.width+"px")),g.height&&(isNaN(g.height)?f.css("height",g.height):f.css("height",g.height+"px"));var q=new L.Map(f[0],{maxZoom:p.maxZoom,minZoom:p.minZoom,doubleClickZoom:p.doubleClickZoom,scrollWheelZoom:p.scrollWheelZoom,attributionControl:p.attributionControl});h(q,a.tiles,p),o(q,a.center,p)}}}])}();