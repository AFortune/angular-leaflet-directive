/**!
 * The MIT License
 *
 * Copyright (c) 2013 the angular-leaflet-directive Team, http://tombatossals.github.io/angular-leaflet-directive
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 *
 * angular-google-maps
 * https://github.com/tombatossals/angular-leaflet-directive
 *
 * @authors https://github.com/tombatossals/angular-leaflet-directive/graphs/contributors
 */

/*! angular-leaflet-directive 13-11-2013 */
!function(){"use strict";function a(a){return angular.isDefined(a)}function b(a){return angular.isDefined(a)&&null!==a}function c(a){return angular.isNumber(a)}function d(a){return angular.isString(a)}function e(a){return angular.isArray(a)}function f(a,b){var c=a.$root.$$phase;"$apply"===c||"$digest"===c?a.$eval(b):a.$apply(b)}angular.module("leaflet-directive",[]).directive("leaflet",["$log","$q","leafletData","leafletMapDefaults",function(b,c,d,e){return{restrict:"E",replace:!0,transclude:!0,scope:{center:"=center",defaults:"=defaults",maxBounds:"=maxbounds",bounds:"=bounds",marker:"=marker",markers:"=markers",legend:"=legend",geojson:"=geojson",paths:"=paths",tiles:"=tiles",layers:"=layers",controls:"=controls",eventBroadcast:"=eventBroadcast"},template:'<div class="angular-leaflet-map" ng-transclude></div>',controller:["$scope",function(a){a.leafletMap=c.defer(),this.getMap=function(){return a.leafletMap.promise}}],link:function(c,f,g){var h=e(c.defaults);d.setDefaults(h),a(c.maxBounds)&&(h.minZoom=void 0),a(g.width)&&(isNaN(g.width)?f.css("width",g.width):f.css("width",g.width+"px")),a(g.height)&&(isNaN(g.height)?f.css("height",g.height):f.css("height",g.height+"px")),a(g.marker)&&b.warn("[AngularJS - Leaflet] The 'marker' property is currently deprecated, please use the 'markers' property instead.");var i=new L.Map(f[0],{maxZoom:h.maxZoom,minZoom:h.minZoom,keyboard:h.keyboard,dragging:h.dragging,zoomControl:h.zoomControl,doubleClickZoom:h.doubleClickZoom,scrollWheelZoom:h.scrollWheelZoom,attributionControl:h.attributionControl});if(c.leafletMap.resolve(i),d.setMap(i,g.id),a(g.center)||(b.warn("[AngularJS - Leaflet] 'center' is undefined in the current scope, did you forget to initialize it?"),i.setView([h.center.lat,h.center.lng],h.center.zoom)),!(a(g.tiles)||a(g.layers)&&a(c.layers.baselayers))){var j=L.tileLayer(h.tileLayer,h.tileLayerOptions);j.addTo(i),d.setTiles(j)}a(i.zoomControl)&&a(h.zoomControlPosition)&&i.zoomControl.setPosition(h.zoomControlPosition)}}}]),angular.module("leaflet-directive").directive("center",["$log","$parse","leafletMapDefaults",function(b,d,e){return{restrict:"A",scope:!1,replace:!1,transclude:!1,require:"leaflet",link:function(g,h,i,j){var k=e(g.defaults),l=g.center,m=g.bounds;j.getMap().then(function(e){function h(a){if(m){var b=a.getBounds(),c=b.getSouthWest(),d=b.getNorthEast();m={southWest:{lat:c.lat,lng:c.lng},northEast:{lat:d.lat,lng:d.lng}}}}function i(a,b){a.setView([b.lat,b.lng],b.zoom),h(a)}function j(b){return a(b)&&c(b.lat)&&c(b.lng)&&c(b.zoom)}if(a(l)){l.autoDiscover===!0&&e.locate({setView:!0,maxZoom:k.maxZoom});var n={lat:d("center.lat"),lng:d("center.lng"),zoom:d("center.zoom")}}else b.warn("[AngularJS - Leaflet] 'center' is undefined in the current scope, did you forget to initialize it?"),e.setView([k.center.lat,k.center.lng],k.center.zoom);var o=!1;g.$watch("center",function(a){return j(a)?(o||i(e,a),void 0):(b.warn("[AngularJS - Leaflet] invalid 'center'"),i(e,k.center),void 0)},!0),e.on("movestart",function(){o=!0}),e.on("moveend",function(){o=!1,f(g,function(a){n&&(n.lat.assign(a,e.getCenter().lat),n.lng.assign(a,e.getCenter().lng),n.zoom.assign(a,e.getZoom())),a.$emit("centerUpdated")})})})}}}]),angular.module("leaflet-directive").directive("tiles",["$log","leafletData","leafletMapDefaults",function(a,b,c){return{restrict:"A",scope:!1,replace:!1,transclude:!1,require:"leaflet",link:function(d,e,f,g){var h=c(d.defaults),i=d.tiles;g.getMap().then(function(c){var e,g=h.tileLayer,j=h.tileLayerOptions;angular.isDefined(i)&&angular.isDefined(i.url)?(g=i.url,d.$watch("tiles.url",function(a){angular.isDefined(a)&&e.setUrl(a)})):a.warn("[AngularJS - Leaflet] The 'tiles' definition doesn't have the 'url' property."),angular.isDefined(i)&&angular.isDefined(i.options)&&angular.copy(i.options,j),e=L.tileLayer(g,j),e.addTo(c),b.setTiles(e,f.id)})}}}]),angular.module("leaflet-directive").directive("legend",["$log",function(a){return{restrict:"A",scope:!1,replace:!1,transclude:!1,require:"leaflet",link:function(b,c,d,f){f.getMap().then(function(c){var d=b.legend;if(e(d.colors)&&e(d.labels)&&d.colors.length===d.labels.length){var f=d.legendClass?d.legendClass:"legend",g=d.position||"bottomright",h=L.control({position:g});h.onAdd=function(){for(var a=L.DomUtil.create("div",f),b=0;b<d.colors.length;b++)a.innerHTML+='<div><i style="background:'+d.colors[b]+'"></i>'+d.labels[b]+"</div>";return a},h.addTo(c)}else a.warn("[AngularJS - Leaflet] legend.colors and legend.labels must be set.")})}}}]),angular.module("leaflet-directive").directive("geojson",["$log","$rootScope","leafletData",function(b,c,d){return{restrict:"A",scope:!1,replace:!1,transclude:!1,require:"leaflet",link:function(b,e,g,h){h.getMap();var i={};h.getMap().then(function(e){b.$watch("geojson",function(g){if(a(g)&&(a(i)&&e.removeLayer(i),a(g.data))){var h=g.resetStyleOnMouseout,j=function(a,d){d.on({mouseover:function(d){f(b,function(){g.selected=a,c.$broadcast("leafletDirectiveMap.geojsonMouseover",d)})},mouseout:function(a){h&&i.resetStyle(a.target),f(b,function(){g.selected=void 0,c.$broadcast("leafletDirectiveMap.geojsonMouseout",a)})},click:function(a){f(b,function(){c.$broadcast("leafletDirectiveMap.geojsonClick",g.selected,a)})}})};a(g.options)?a(g.options.onEachFeature)||(g.options.onEachFeature=j):g.options={style:g.style,onEachFeature:j},i=L.geoJson(g.data,g.options),d.setGeoJSON(i),i.addTo(e)}})})}}}]),angular.module("leaflet-directive").directive("layers",["$log","$q","leafletData","leafletHelpers","leafletMapDefaults",function(b,c,e,f,g){return{restrict:"A",scope:!1,replace:!1,transclude:!1,require:"leaflet",controller:["$scope",function(a){a.leafletLayers=c.defer(),this.getLayers=function(){return a.leafletLayers.promise}}],link:function(c,h,i,j){var k,l=g(c.defaults),m=c.layers,n=f;j.getMap().then(function(f){function g(a){if(!d(a.type))return b.error("[AngularJS - Leaflet] A base layer must have a type"),null;if("xyz"!==a.type&&"wms"!==a.type&&"group"!==a.type&&"markercluster"!==a.type&&"google"!==a.type&&"bing"!==a.type)return b.error('[AngularJS - Leaflet] A layer must have a valid type: "xyz, wms, group, google"'),null;if(("xyz"===a.type||"wms"===a.type)&&!d(a.url))return b.error("[AngularJS - Leaflet] A base layer must have an url"),null;if(!d(a.name))return b.error("[AngularJS - Leaflet] A base layer must have a name"),null;(void 0===a.layerParams||null===a.layerParams||"object"!=typeof a.layerParams)&&(a.layerParams={}),(void 0===a.layerOptions||null===a.layerOptions||"object"!=typeof a.layerOptions)&&(a.layerOptions={});var c=null;for(var e in a.layerParams)a.layerOptions[e]=a.layerParams[e];switch(a.type){case"xyz":c=h(a.url,a.layerOptions);break;case"wms":c=j(a.url,a.layerOptions);break;case"group":c=o();break;case"markercluster":c=p(a.layerOptions);break;case"google":c=q(a.layerType,a.layerOptions);break;case"bing":c=r(a.bingKey,a.layerOptions);break;default:c=null}return c}function h(a,b){var c=L.tileLayer(a,b);return c}function j(a,b){var c=L.tileLayer.wms(a,b);return c}function o(){var a=L.layerGroup();return a}function p(a){if(n.MarkerClusterPlugin.isLoaded()){var b=new L.MarkerClusterGroup(a);return b}return null}function q(a,b){if(a=a||"SATELLITE",n.GoogleLayerPlugin.isLoaded()){var c=new L.Google(a,b);return c}return null}function r(a,b){if(n.BingLayerPlugin.isLoaded()){var c=new L.BingLayer(a,b);return c}return null}if(a(m)){if(!a(m.baselayers)||Object.keys(c.layers.baselayers).length<=0)return b.error("[AngularJS - Leaflet] At least one baselayer has to be defined"),void 0;k={},c.leafletLayers.resolve(k),e.setLayers(k,i.id),k.baselayers={},k.controls={},k.controls.layers=new L.control.layers,k.controls.layers.setPosition(l.controlLayersPosition),k.controls.layers.addTo(f);var s=!1;for(var t in m.baselayers){var u=g(m.baselayers[t]);null!==u&&(k.baselayers[t]=u,m.baselayers[t].top===!0&&(f.addLayer(k.baselayers[t]),s=!0),k.controls.layers.addBaseLayer(k.baselayers[t],m.baselayers[t].name))}!s&&Object.keys(k.baselayers).length>0&&f.addLayer(k.baselayers[Object.keys(m.baselayers)[0]]),k.overlays={};for(t in m.overlays){var v=g(m.overlays[t]);null!==v&&(k.overlays[t]=v,m.overlays[t].visible===!0&&f.addLayer(k.overlays[t]),k.controls.layers.addOverlay(k.overlays[t],m.overlays[t].name))}c.$watch("layers.baselayers",function(a){for(var c in k.baselayers)void 0===a[c]&&(k.controls.layers.removeLayer(k.baselayers[c]),f.hasLayer(k.baselayers[c])&&f.removeLayer(k.baselayers[c]),delete k.baselayers[c]);for(var d in a)if(void 0===k.baselayers[d]){var e=g(a[d]);null!==e&&(k.baselayers[d]=e,a[d].top===!0&&f.addLayer(k.baselayers[d]),k.controls.layers.addBaseLayer(k.baselayers[d],a[d].name))}if(Object.keys(k.baselayers).length<=0)b.error("[AngularJS - Leaflet] At least one baselayer has to be defined");else{var h=!1;for(var i in k.baselayers)if(f.hasLayer(k.baselayers[i])){h=!0;break}h||f.addLayer(k.baselayers[Object.keys(m.baselayers)[0]])}},!0),c.$watch("layers.overlays",function(a){for(var b in k.overlays)void 0===a[b]&&(k.controls.layers.removeLayer(k.overlays[b]),f.hasLayer(k.overlays[b])&&f.removeLayer(k.overlays[b]),delete k.overlays[b]);for(var c in a)if(void 0===k.overlays[c]){var d=g(a[c]);null!==d&&(k.overlays[c]=d,k.controls.layers.addOverlay(k.overlays[c],a[c].name),a[c].visible===!0&&f.addLayer(k.overlays[c]))}},!0)}})}}}]),angular.module("leaflet-directive").directive("bounds",["$log",function(b){return{restrict:"A",scope:!1,replace:!1,transclude:!1,require:"leaflet",link:function(d,e,f,g){g.getMap().then(function(e){function f(b){return a(b)&&a(b.southWest)&&a(b.northEast)&&c(b.southWest.lat)&&c(b.southWest.lng)&&c(b.northEast.lat)&&c(b.northEast.lng)}function g(c){d.$watch("bounds",function(d){if(!a(d)||!f(d))return b.error("[AngularJS - Leaflet] Invalid bounds"),void 0;var e=d.southWest,g=d.northEast,h=new L.LatLngBounds(new L.LatLng(e.lat,e.lng),new L.LatLng(g.lat,g.lng));c.getBounds().equals(h)||c.fitBounds(h)},!0)}g(e)})}}}]),angular.module("leaflet-directive").directive("markers",["$log","$rootScope","$q","leafletData","leafletHelpers","leafletMapDefaults",function(e,g,h,i,j,k){return{restrict:"A",scope:!1,replace:!1,transclude:!1,require:["leaflet","?layers"],link:function(l,m,n,o){var p=k(l.defaults),q=o[0],r=j;q.getMap().then(function(j){var k,m=l.markers,q={},s={};k=a(o[1])?o[1].getLayers:function(){var a=h.defer();return a.resolve(),a.promise};var t=L.Icon.extend({options:{iconUrl:p.icon.url,iconRetinaUrl:p.icon.retinaUrl,iconSize:p.icon.size,iconAnchor:p.icon.anchor,labelAnchor:p.icon.labelAnchor,popupAnchor:p.icon.popup,shadowUrl:p.icon.shadow.url,shadowRetinaUrl:p.icon.shadow.retinaUrl,shadowSize:p.icon.shadow.size,shadowAnchor:p.icon.shadow.anchor}});a(m)&&k().then(function(h){function k(i,j,k){function n(a,b){return function(c){var d="leafletDirectiveMarker."+a,e=i.replace("markers.","");"click"===a?f(l,function(){g.$broadcast("leafletDirectiveMarkersClick",e)}):"dragend"===a&&(f(l,function(){j.lat=o.getLatLng().lat,j.lng=o.getLatLng().lng}),j.message&&j.focus===!0&&o.openPopup()),f(l,function(a){"emit"===b?a.$emit(d,{markerName:e,leafletEvent:c}):g.$broadcast(d,{markerName:e,leafletEvent:c})})}}var o=m(j);if(a(j.layer)){if(!d(j.layer))return e.error("[AngularJS - Leaflet] A layername must be a string"),null;if(!b(h))return e.error("[AngularJS - Leaflet] You must add layers to the directive if used in a marker"),null;if(!b(h.overlays))return e.error("[AngularJS - Leaflet] You must add layers overlays to the directive if used in a marker"),null;if(!b(h.overlays[j.layer]))return e.error("[AngularJS - Leaflet] You must use a name of an existing layer"),null;var p=h.overlays[j.layer];if(!(p instanceof L.LayerGroup))return e.error('[AngularJS - Leaflet] A marker can only be added to a layer of type "group"'),null;p.addLayer(o),k.hasLayer(o)&&j.focus===!0&&o.openPopup()}else a(j.group)?(a(s[j.group])||(s[j.group]=L.markerClusterGroup({spiderfyOnMaxZoom:!1,showCoverageOnHover:!1,zoomToBoundsOnClick:!1}),k.addLayer(s[j.group])),s[j.group].addLayer(o)):k.addLayer(o),a(L.Label)&&a(j.label)&&a(j.label.options)&&j.label.options.noHide===!0&&o.showLabel(),j.focus===!0&&o.openPopup();var q,u,v=["click","dblclick","mousedown","mouseover","mouseout","contextmenu","dragstart","drag","dragend","move","remove","popupopen","popupclose"],w=[],x="broadcast";if(void 0===l.eventBroadcast||null===l.eventBroadcast)w=v;else if("object"!=typeof l.eventBroadcast)e.warn("[AngularJS - Leaflet] event-broadcast must be an object check your model.");else if(void 0===l.eventBroadcast.marker||null===l.eventBroadcast.marker)w=v;else if("object"!=typeof l.eventBroadcast.marker)e.warn("[AngularJS - Leaflet] event-broadcast.marker must be an object check your model.");else{void 0!==l.eventBroadcast.marker.logic&&null!==l.eventBroadcast.marker.logic&&("emit"!==l.eventBroadcast.marker.logic&&"broadcast"!==l.eventBroadcast.marker.logic?e.warn("[AngularJS - Leaflet] Available event propagation logic are: 'emit' or 'broadcast'."):"emit"===l.eventBroadcast.marker.logic&&(x="emit"));var y=!1,z=!1;if(void 0!==l.eventBroadcast.marker.enable&&null!==l.eventBroadcast.marker.enable&&"object"==typeof l.eventBroadcast.marker.enable&&(y=!0),void 0!==l.eventBroadcast.marker.disable&&null!==l.eventBroadcast.marker.disable&&"object"==typeof l.eventBroadcast.marker.disable&&(z=!0),y&&z)e.warn("[AngularJS - Leaflet] can not enable and disable events at the same time");else if(y||z)if(y)for(q=0;q<l.eventBroadcast.marker.enable.length;q++)u=l.eventBroadcast.marker.enable[q],-1!==w.indexOf(u)?e.warn("[AngularJS - Leaflet] This event "+u+" is already enabled"):-1===v.indexOf(u)?e.warn("[AngularJS - Leaflet] This event "+u+" does not exist"):w.push(u);else for(w=v,q=0;q<l.eventBroadcast.marker.disable.length;q++){u=l.eventBroadcast.marker.disable[q];var A=w.indexOf(u);-1===A?e.warn("[AngularJS - Leaflet] This event "+u+" does not exist or has been already disabled"):w.splice(A,1)}else e.warn("[AngularJS - Leaflet] must enable or disable events")}for(q=0;q<w.length;q++)u=w[q],o.on(u,n(u,x),{eventName:u,scope_watch_name:i});var B=l.$watch(i,function(f,g){if(!b(f)){if(o.closePopup(),b(h)&&a(h.overlays))for(var i in h.overlays)h.overlays[i]instanceof L.LayerGroup&&h.overlays[i].hasLayer(o)&&h.overlays[i].removeLayer(o);return k.removeLayer(o),B(),void 0}if(a(g)){if(d(f.layer)){if(b(g.layer)||g.layer!==f.layer)if("string"==typeof g.layer&&void 0!==h.overlays[g.layer]&&h.overlays[g.layer].hasLayer(o)&&h.overlays[g.layer].removeLayer(o),o.closePopup(),k.hasLayer(o)&&k.removeLayer(o),void 0!==h.overlays[f.layer]){var j=h.overlays[f.layer];j instanceof L.LayerGroup?(j.addLayer(o),k.hasLayer(o)&&f.focus===!0&&o.openPopup()):e.error('[AngularJS - Leaflet] A marker can only be added to a layer of type "group"')}else e.error("[AngularJS - Leaflet] You must use a name of an existing layer")}else d(g.layer)&&(a(h.overlays[g.layer])&&h.overlays[g.layer].hasLayer(o)&&(h.overlays[g.layer].removeLayer(o),o.closePopup()),k.hasLayer(o)||k.addLayer(o));if(void 0===f.draggable||null===f.draggable||f.draggable!==!0?void 0!==g.draggable&&null!==g.draggable&&g.draggable===!0&&o.dragging&&o.dragging.disable():(void 0===g.draggable||null===g.draggable||g.draggable!==!0)&&(o.dragging?o.dragging.enable():L.Handler.MarkerDrag&&(o.dragging=new L.Handler.MarkerDrag(o),o.options.draggable=!0,o.dragging.enable())),void 0===f.icon||null===f.icon||"object"!=typeof f.icon)void 0!==g.icon&&null!==g.icon&&"object"==typeof g.icon&&(o.setIcon(new t),o.closePopup(),o.unbindPopup(),void 0!==f.message&&null!==f.message&&"string"==typeof f.message&&""!==f.message&&o.bindPopup(f.message));else if(void 0===g.icon||null===g.icon||"object"!=typeof g.icon){var l=!1;o.dragging&&(l=o.dragging.enabled()),r.AwesomeMarkersPlugin.is(f.icon)?o.setIcon(f.icon):r.Leaflet.DivIcon.is(f.icon)||r.Leaflet.Icon.is(f.icon)?o.setIcon(f.icon):o.setIcon(new t(f.icon)),l&&o.dragging.enable(),o.closePopup(),o.unbindPopup(),void 0!==f.message&&null!==f.message&&"string"==typeof f.message&&""!==f.message&&o.bindPopup(f.message)}else if(r.AwesomeMarkersPlugin.is(f.icon)){if(!r.AwesomeMarkersPlugin.equal(f.icon,g.icon)){var m=!1;o.dragging&&(m=o.dragging.enabled()),o.setIcon(f.icon),m&&o.dragging.enable(),o.closePopup(),o.unbindPopup(),void 0!==f.message&&null!==f.message&&"string"==typeof f.message&&""!==f.message&&o.bindPopup(f.message)}}else if(r.Leaflet.DivIcon.is(f.icon)){if(!r.Leaflet.DivIcon.equal(f.icon,g.icon)){var n=!1;o.dragging&&(n=o.dragging.enabled()),o.setIcon(f.icon),n&&o.dragging.enable(),o.closePopup(),o.unbindPopup(),void 0!==f.message&&null!==f.message&&"string"==typeof f.message&&""!==f.message&&o.bindPopup(f.message)}}else if(r.Leaflet.Icon.is(f.icon)){if(!r.Leaflet.Icon.equal(f.icon,g.icon)){var p=!1;o.dragging&&(p=o.dragging.enabled()),o.setIcon(f.icon),p&&o.dragging.enable(),o.closePopup(),o.unbindPopup(),void 0!==f.message&&null!==f.message&&"string"==typeof f.message&&""!==f.message&&o.bindPopup(f.message)}}else if(JSON.stringify(f.icon)!==JSON.stringify(g.icon)){var q=!1;o.dragging&&(q=o.dragging.enabled()),o.setIcon(new t(f.icon)),q&&o.dragging.enable(),o.closePopup(),o.unbindPopup(),void 0!==f.message&&null!==f.message&&"string"==typeof f.message&&""!==f.message&&o.bindPopup(f.message)}if(void 0===f.message||null===f.message||"string"!=typeof f.message||""===f.message?void 0!==g.message&&null!==g.message&&"string"==typeof g.message&&""!==g.message&&(o.closePopup(),o.unbindPopup()):void 0===g.message||null===g.message||"string"!=typeof g.message||""===g.message?(o.bindPopup(f.message),f.focus===!0&&o.openPopup()):f.message!==g.message&&o.setPopupContent(f.message),void 0===f.focus||null===f.focus||f.focus!==!0?void 0!==g.focus&&null!==g.focus&&g.focus===!0&&o.closePopup():void 0===g.focus||null===g.focus||g.focus!==!0?o.openPopup():g.focus===!0&&f.focus===!0&&o.openPopup(),c(f.lat)&&c(f.lng)){var s=o.getLatLng();if(s.lat!==f.lat||s.lng!==f.lng){var u=!1;d(f.layer)&&r.MarkerClusterPlugin.is(h.overlays[f.layer])&&(h.overlays[f.layer].removeLayer(o),u=!0),o.setLatLng([f.lat,f.lng]),u&&h.overlays[f.layer].addLayer(o)}}else{if(e.warn("There are problems with lat-lng data, please verify your marker model"),b(h)&&b(h.overlays))for(var v in h.overlays)(h.overlays[v]instanceof L.LayerGroup||r.MarkerClusterPlugin.is(h.overlays[v]))&&h.overlays[v].hasLayer(o)&&h.overlays[v].removeLayer(o);k.removeLayer(o)}}},!0);return o}function m(b){var c=null;c=b.icon?b.icon:new t;var d={icon:c,draggable:b.draggable?!0:!1};b.title&&(d.title=b.title);var e=new L.marker(b,d);return b.message&&e.bindPopup(b.message),a(L.Label)&&a(b.label)&&a(b.label.message)&&e.bindLabel(b.label.message,b.label.options),e}i.setMarkers(q,n.id),l.$watch("markers",function(c){for(var d in q)if(!a(c[d])){if(q[d].closePopup(),b(h)&&a(h.overlays))for(var e in h.overlays)h.overlays[e]instanceof L.LayerGroup&&h.overlays[e].hasLayer(q[d])&&h.overlays[e].removeLayer(q[d]);if(b(s))for(var f in s)s[f].hasLayer(q[d])&&s[f].removeLayer(q[d]);j.removeLayer(q[d]),delete q[d]}for(var g in c)if(!a(q[g])){var i=k("markers."+g,c[g],j);null!==i&&(q[g]=i)}},!0)})})}}}]),angular.module("leaflet-directive").directive("paths",["$log","leafletData","leafletMapDefaults",function(b,c,d){return{restrict:"A",scope:!1,replace:!1,transclude:!1,require:"leaflet",link:function(b,e,f,g){var h=d(b.defaults),i=b.paths;g.getMap().then(function(d){function e(d,e,h){var i={};c.setPaths(i,f.id),a(d)&&b.$watch("paths",function(b){for(var c in b)a(i[c])||(i[c]=g(c,b[c],e,h));for(var d in i)a(b[d])||delete i[d]},!0)}function g(c,d,e,f){function g(b){if(a(b.latlngs))switch(b.type){default:case"polyline":case"polygon":h.setLatLngs(k(b.latlngs));break;case"multiPolyline":case"multiPolygon":h.setLatLngs(l(b.latlngs));break;case"rectangle":h.setBounds(new L.LatLngBounds(k(b.latlngs)));break;case"circle":case"circleMarker":h.setLatLng(j(b.latlngs)),a(b.radius)&&h.setRadius(b.radius)}a(b.weight)&&h.setStyle({weight:b.weight}),a(b.color)&&h.setStyle({color:b.color}),a(b.opacity)&&h.setStyle({opacity:b.opacity})}var h,i={weight:f.path.weight,color:f.path.color,opacity:f.path.opacity};switch(a(d.stroke)&&(i.stroke=d.stroke),a(d.fill)&&(i.fill=d.fill),a(d.fillColor)&&(i.fillColor=d.fillColor),a(d.fillOpacity)&&(i.fillOpacity=d.fillOpacity),a(d.smoothFactor)&&(i.smoothFactor=d.smoothFactor),a(d.noClip)&&(i.noClip=d.noClip),a(d.type)||(d.type="polyline"),d.type){default:case"polyline":h=new L.Polyline([],i);break;case"multiPolyline":h=new L.multiPolyline([[[0,0],[1,1]]],i);break;case"polygon":h=new L.Polygon([],i);break;case"multiPolygon":h=new L.MultiPolygon([[[0,0],[1,1],[0,1]]],i);break;case"rectangle":h=new L.Rectangle([[0,0],[1,1]],i);break;case"circle":h=new L.Circle([0,0],1,i);break;case"circleMarker":h=new L.CircleMarker([0,0],i)}e.addLayer(h);var m=b.$watch("paths."+c,function(b){return a(b)?(g(b),void 0):(e.removeLayer(h),m(),void 0)},!0);return h}function j(a){return new L.LatLng(a.lat,a.lng)}function k(a){return a.filter(function(a){return!!a.lat&&!!a.lng}).map(function(a){return new L.LatLng(a.lat,a.lng)})}function l(a){return a.map(function(a){return k(a)})}e(i,d,h)})}}}]),angular.module("leaflet-directive").directive("controls",["$log",function(){return{restrict:"A",scope:!1,replace:!1,transclude:!1,require:"leaflet",link:function(b,c,d,e){var f=b.controls;e.getMap().then(function(b){if(a(L.Control.Draw)&&a(f.draw)){var c=new L.Control.Draw(f.draw.options);b.addControl(c)}})}}}]),angular.module("leaflet-directive").directive("eventBroadcast",["$log","$rootScope",function(a,c){return{restrict:"A",scope:!1,replace:!1,transclude:!1,require:"leaflet",link:function(d,e,g,h){h.getMap().then(function(e){function g(a,b){return function(e){var g="leafletDirectiveMap."+a;f(d,function(a){"emit"===b?a.$emit(g,{leafletEvent:e}):"broadcast"===b&&c.$broadcast(g,{leafletEvent:e})})}}var h,i,j=["click","dblclick","mousedown","mouseup","mouseover","mouseout","mousemove","contextmenu","focus","blur","preclick","load","unload","viewreset","movestart","move","moveend","dragstart","drag","dragend","zoomstart","zoomend","zoomlevelschange","resize","autopanstart","layeradd","layerremove","baselayerchange","overlayadd","overlayremove","locationfound","locationerror","popupopen","popupclose"],k=[],l="broadcast";if(b(d.eventBroadcast))if("object"!=typeof d.eventBroadcast)a.warn("[AngularJS - Leaflet] event-broadcast must be an object check your model.");else if(void 0===d.eventBroadcast.map||null===d.eventBroadcast.map)k=j;else if("object"!=typeof d.eventBroadcast.map)a.warn("[AngularJS - Leaflet] event-broadcast.map must be an object check your model.");else{void 0!==d.eventBroadcast.map.logic&&null!==d.eventBroadcast.map.logic&&("emit"!==d.eventBroadcast.map.logic&&"broadcast"!==d.eventBroadcast.map.logic?a.warn("[AngularJS - Leaflet] Available event propagation logic are: 'emit' or 'broadcast'."):"emit"===d.eventBroadcast.map.logic&&(l="emit"));var m=!1,n=!1;if(void 0!==d.eventBroadcast.map.enable&&null!==d.eventBroadcast.map.enable&&"object"==typeof d.eventBroadcast.map.enable&&(m=!0),void 0!==d.eventBroadcast.map.disable&&null!==d.eventBroadcast.map.disable&&"object"==typeof d.eventBroadcast.map.disable&&(n=!0),m&&n)a.warn("[AngularJS - Leaflet] can not enable and disable events at the time");else if(m||n)if(m)for(h=0;h<d.eventBroadcast.map.enable.length;h++)i=d.eventBroadcast.map.enable[h],-1!==k.indexOf(i)?a.warn("[AngularJS - Leaflet] This event "+i+" is already enabled"):-1===j.indexOf(i)?a.warn("[AngularJS - Leaflet] This event "+i+" does not exist"):k.push(i);else for(k=j,h=0;h<d.eventBroadcast.map.disable.length;h++){i=d.eventBroadcast.map.disable[h];var o=k.indexOf(i);-1===o?a.warn("[AngularJS - Leaflet] This event "+i+" does not exist or has been already disabled"):k.splice(o,1)}else a.warn("[AngularJS - Leaflet] must enable or disable events")}else k=j;for(h=0;h<k.length;h++)i=k[h],e.on(i,g(i,l),{eventName:i})})}}}]),angular.module("leaflet-directive").directive("maxbounds",["$log","leafletMapDefaults",function(b,d){return{restrict:"A",scope:!1,replace:!1,transclude:!1,require:"leaflet",link:function(e,f,g,h){d(e.defaults),h.getMap().then(function(d){var f=e.maxBounds;a(f)&&a(f.southWest)&&a(f.northEast)?e.$watch("maxBounds",function(b){a(b.southWest)&&a(b.northEast)&&c(b.southWest.lat)&&c(b.southWest.lng)&&c(b.northEast.lat)&&c(b.northEast.lng)&&d.setMaxBounds(new L.LatLngBounds(new L.LatLng(b.southWest.lat,b.southWest.lng),new L.LatLng(b.northEast.lat,b.northEast.lng)))}):b.warn("[AngularJS - Leaflet] 'maxBounds' is defined in the current scope, but not correctly initialized.")})}}}]),angular.module("leaflet-directive").service("leafletData",["$log","$q",function(b,c){function d(b,d){a(d)||(d="main");var e;return a(b[d])?e=b[d]:(e=c.defer(),b[d]=e),e}var e={main:c.defer()},f={main:c.defer()},g={main:c.defer()},h={main:c.defer()},i={main:c.defer()},j={main:c.defer()},k={};this.setMap=function(a,b){var c=d(e,b);c.resolve(a)},this.getMap=function(a){var b=d(e,a);return b.promise},this.getDefaults=function(){return k},this.setDefaults=function(a){k=a},this.getPaths=function(a){var b=d(h,a);return b.promise},this.setPaths=function(a,b){var c=d(h,b);c.resolve(a)},this.getMarkers=function(a){var b=d(i,a);return b.promise},this.setMarkers=function(a,b){var c=d(i,b);c.resolve(a)},this.getLayers=function(a){var b=d(g,a);return b.promise},this.setLayers=function(a,b){var c=d(g,b);c.resolve(a)},this.setTiles=function(a,b){var c=d(f,b);c.resolve(a)},this.getTiles=function(a){var b=d(f,a);return b.promise},this.setGeoJSON=function(a,b){var c=d(j,b);c.resolve(a)},this.getGeoJSON=function(a){var b=d(j,a);return b.promise}}]),angular.module("leaflet-directive").factory("leafletMapDefaults",function(){function b(){return{maxZoom:18,minZoom:1,keyboard:!0,dragging:!0,doubleClickZoom:!0,scrollWheelZoom:!0,zoomControl:!0,attributionControl:!0,zoomsliderControl:!1,zoomControlPosition:"topleft",controlLayersPosition:"topright",tileLayer:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",tileLayerOptions:{attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'},icon:{url:"http://cdn.leafletjs.com/leaflet-0.6.4/images/marker-icon.png",retinaUrl:"http://cdn.leafletjs.com/leaflet-0.6.4/images/marker-icon-2x.png",size:[25,41],anchor:[12,40],labelAnchor:[10,-20],popup:[0,-40],shadow:{url:"http://cdn.leafletjs.com/leaflet-0.6.4/images/marker-shadow.png",retinaUrl:"http://cdn.leafletjs.com/leaflet-0.6.4/images/marker-shadow.png",size:[41,41],anchor:[12,40]}},path:{weight:10,opacity:1,color:"#0000ff"},center:{lat:0,lng:0,zoom:1}}}return function(c){var d=b();return a(c)&&(d.maxZoom=a(c.maxZoom)?parseInt(c.maxZoom,10):d.maxZoom,d.minZoom=a(c.minZoom)?parseInt(c.minZoom,10):d.minZoom,d.doubleClickZoom=a(c.doubleClickZoom)?c.doubleClickZoom:d.doubleClickZoom,d.scrollWheelZoom=a(c.scrollWheelZoom)?c.scrollWheelZoom:d.doubleClickZoom,d.zoomControl=a(c.zoomControl)?c.zoomControl:d.zoomControl,d.attributionControl=a(c.attributionControl)?c.attributionControl:d.attributionControl,d.tileLayer=a(c.tileLayer)?c.tileLayer:d.tileLayer,d.zoomControlPosition=a(c.zoomControlPosition)?c.zoomControlPosition:d.zoomControlPosition,d.keyboard=a(c.keyboard)?c.keyboard:d.keyboard,d.dragging=a(c.dragging)?c.dragging:d.dragging,d.controlLayersPosition=a(c.controlLayersPosition)?c.controlLayersPosition:d.controlLayersPosition,a(c.tileLayerOptions)&&angular.copy(c.tileLayerOptions,d.tileLayerOptions)),d}}),angular.module("leaflet-directive").factory("leafletHelpers",function(){return{AwesomeMarkersPlugin:{isLoaded:function(){return void 0!==L.AwesomeMarkers?void 0!==L.AwesomeMarkers.Icon:!1},is:function(a){return this.isLoaded()?a instanceof L.AwesomeMarkers.Icon:!1},equal:function(a,b){return this.isLoaded?this.is(a)&&this.is(b)?a.options.icon===b.options.icon&&a.options.iconColor===b.options.iconColor&&a.options.color===b.options.color&&a.options.iconSize[0]===b.options.iconSize[0]&&a.options.iconSize[1]===b.options.iconSize[1]&&a.options.iconAnchor[0]===b.options.iconAnchor[0]&&a.options.iconAnchor[1]===b.options.iconAnchor[1]&&a.options.popupAnchor[0]===b.options.popupAnchor[0]&&a.options.popupAnchor[1]===b.options.popupAnchor[1]&&a.options.shadowAnchor[0]===b.options.shadowAnchor[0]&&a.options.shadowAnchor[1]===b.options.shadowAnchor[1]&&a.options.shadowSize[0]===b.options.shadowSize[0]&&a.options.shadowSize[1]===b.options.shadowSize[1]:!1:!1}},MarkerClusterPlugin:{isLoaded:function(){return void 0!==L.MarkerClusterGroup},is:function(a){return this.isLoaded()?a instanceof L.MarkerClusterGroup:!1}},GoogleLayerPlugin:{isLoaded:function(){return void 0!==L.Google},is:function(a){return this.isLoaded()?a instanceof L.Google:!1}},BingLayerPlugin:{isLoaded:function(){return void 0!==L.BingLayer},is:function(a){return this.isLoaded()?a instanceof L.BingLayer:!1}},Leaflet:{DivIcon:{is:function(a){return a instanceof L.DivIcon},equal:function(a,b){return this.is(a)&&this.is(b)?a.options.html===b.options.html&&a.options.iconSize[0]===b.options.iconSize[0]&&a.options.iconSize[1]===b.options.iconSize[1]&&a.options.iconAnchor[0]===b.options.iconAnchor[0]&&a.options.iconAnchor[1]===b.options.iconAnchor[1]:!1}},Icon:{is:function(a){return a instanceof L.Icon},equal:function(a,b){return this.is(a)&&this.is(b)?a.options.iconUrl===b.options.iconUrl&&a.options.iconRetinaUrl===b.options.iconRetinaUrl&&a.options.iconSize[0]===b.options.iconSize[0]&&a.options.iconSize[1]===b.options.iconSize[1]&&a.options.iconAnchor[0]===b.options.iconAnchor[0]&&a.options.iconAnchor[1]===b.options.iconAnchor[1]&&a.options.shadowUrl===b.options.shadowUrl&&a.options.shadowRetinaUrl===b.options.shadowRetinaUrl&&a.options.shadowSize[0]===b.options.shadowSize[0]&&a.options.shadowSize[1]===b.options.shadowSize[1]&&a.options.shadowAnchor[0]===b.options.shadowAnchor[0]&&a.options.shadowAnchor[1]===b.options.shadowAnchor[1]&&a.options.popupAnchor[0]===b.options.popupAnchor[0]&&a.options.popupAnchor[1]===b.options.popupAnchor[1]:!1}}}}})}();