/**!
 * The MIT License
 *
 * Copyright (c) 2013 the angular-leaflet-directive team, http://tombatossals.github.io/angular-leaflet-directive
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 *
 * angular-google-maps
 * https://github.com/tombatossals/angular-leaflet-directive
 *
 * @authors https://github.com/tombatossals/angular-leaflet-directive/graphs/contributors
 */

/*! angular-leaflet-directive 25-10-2013 */
!function(){"use strict";function a(a){return angular.isDefined(a)}function b(a){return angular.isDefined(a)&&null!=a}function c(a){return angular.isNumber(a)}function d(a){return angular.isString(a)}function e(a){return angular.isArray(a)}function f(a){var b=a.$root.$$phase;return!("$apply"===b||"$digest"===b)}function g(a,b){f(a)?a.$apply(b):a.$eval(b)}function h(b){var c=i();return a(b)&&(c.maxZoom=a(b.maxZoom)?parseInt(b.maxZoom,10):c.maxZoom,c.minZoom=a(b.minZoom)?parseInt(b.minZoom,10):c.minZoom,c.doubleClickZoom=a(b.doubleClickZoom)&&b.doubleClickZoom?!0:!1,c.scrollWheelZoom=a(b.scrollWheelZoom)&&b.scrollWheelZoom?!0:!1,c.attributionControl=a(b.attributionControl)&&b.attributionControl?!0:!1,c.tileLayer=a(b.tileLayer)?b.tileLayer:c.tileLayer,c.zoomControlPosition=a(b.zoomControlPosition)?b.zoomControlPosition:c.zoomControlPosition,a(b.tileLayerOptions)&&angular.copy(b.tileLayerOptions,c.tileLayerOptions)),c}function i(){return{maxZoom:14,minZoom:1,doubleClickZoom:!0,scrollWheelZoom:!0,zoomControl:!0,attributionControl:!0,zoomsliderControl:!1,zoomControlPosition:"topleft",controlLayersPosition:"topright",tileLayer:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",tileLayerOptions:{attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'},icon:{url:"http://cdn.leafletjs.com/leaflet-0.6.4/images/marker-icon.png",retinaUrl:"http://cdn.leafletjs.com/leaflet-0.6.4/images/marker-icon-2x.png",size:[25,41],anchor:[12,40],popup:[0,-40],shadow:{url:"http://cdn.leafletjs.com/leaflet-0.6.4/images/marker-shadow.png",retinaUrl:"http://cdn.leafletjs.com/leaflet-0.6.4/images/marker-shadow.png",size:[41,41],anchor:[12,40]}},path:{weight:10,opacity:1,color:"#0000ff"},center:{lat:0,lng:0,zoom:1}}}var j={AwesomeMarkersPlugin:{isLoaded:function(){return void 0!==L.AwesomeMarkers?void 0!==L.AwesomeMarkers.Icon:!1},is:function(a){return this.isLoaded()?a instanceof L.AwesomeMarkers.Icon:!1},equal:function(a,b){return this.isLoaded?this.is(a)&&this.is(b)?a.options.icon===b.options.icon&&a.options.iconColor===b.options.iconColor&&a.options.color===b.options.color&&a.options.iconSize[0]===b.options.iconSize[0]&&a.options.iconSize[1]===b.options.iconSize[1]&&a.options.iconAnchor[0]===b.options.iconAnchor[0]&&a.options.iconAnchor[1]===b.options.iconAnchor[1]&&a.options.popupAnchor[0]===b.options.popupAnchor[0]&&a.options.popupAnchor[1]===b.options.popupAnchor[1]&&a.options.shadowAnchor[0]===b.options.shadowAnchor[0]&&a.options.shadowAnchor[1]===b.options.shadowAnchor[1]&&a.options.shadowSize[0]===b.options.shadowSize[0]&&a.options.shadowSize[1]===b.options.shadowSize[1]:!1:!1}},MarkerClusterPlugin:{isLoaded:function(){return void 0!==L.MarkerClusterGroup},is:function(a){return this.isLoaded()?a instanceof L.MarkerClusterGroup:!1}},GoogleLayerPlugin:{isLoaded:function(){return void 0!==L.Google},is:function(a){return this.isLoaded()?a instanceof L.Google:!1}},BingLayerPlugin:{isLoaded:function(){return void 0!==L.BingLayer},is:function(a){return this.isLoaded()?a instanceof L.BingLayer:!1}},Leaflet:{DivIcon:{is:function(a){return a instanceof L.DivIcon},equal:function(a,b){return this.is(a)&&this.is(b)?a.options.html===b.options.html&&a.options.iconSize[0]===b.options.iconSize[0]&&a.options.iconSize[1]===b.options.iconSize[1]&&a.options.iconAnchor[0]===b.options.iconAnchor[0]&&a.options.iconAnchor[1]===b.options.iconAnchor[1]:!1}},Icon:{is:function(a){return a instanceof L.Icon},equal:function(a,b){return this.is(a)&&this.is(b)?a.options.iconUrl===b.options.iconUrl&&a.options.iconRetinaUrl===b.options.iconRetinaUrl&&a.options.iconSize[0]===b.options.iconSize[0]&&a.options.iconSize[1]===b.options.iconSize[1]&&a.options.iconAnchor[0]===b.options.iconAnchor[0]&&a.options.iconAnchor[1]===b.options.iconAnchor[1]&&a.options.shadowUrl===b.options.shadowUrl&&a.options.shadowRetinaUrl===b.options.shadowRetinaUrl&&a.options.shadowSize[0]===b.options.shadowSize[0]&&a.options.shadowSize[1]===b.options.shadowSize[1]&&a.options.shadowAnchor[0]===b.options.shadowAnchor[0]&&a.options.shadowAnchor[1]===b.options.shadowAnchor[1]&&a.options.popupAnchor[0]===b.options.popupAnchor[0]&&a.options.popupAnchor[1]===b.options.popupAnchor[1]:!1}}}};angular.module("leaflet-directive",[]).directive("leaflet",["$log","$q","leafletData",function(b,d,e){return{restrict:"E",replace:!0,transclude:!0,scope:{center:"=center",defaults:"=defaults",maxBounds:"=maxbounds",bounds:"=bounds",marker:"=marker",markers:"=markers",legend:"=legend",geojson:"=geojson",paths:"=paths",tiles:"=tiles",layers:"=layers",customControls:"=customControls",eventBroadcast:"=eventBroadcast"},template:'<div class="angular-leaflet-map" ng-transclude></div>',controller:["$scope",function(a){a.leafletMapDeferred=d.defer(),this.getMap=function(){return a.leafletMapDeferred.promise}}],link:function(d,f,g){function i(b,c){a(b.zoomControl)&&a(c.zoomControlPosition)&&b.zoomControl.setPosition(c.zoomControlPosition),a(b.zoomControl)&&a(c.zoomControl)&&c.zoomControl===!1&&b.zoomControl.removeFrom(b),a(b.zoomsliderControl)&&a(c.zoomsliderControl)&&c.zoomsliderControl===!1&&b.zoomsliderControl.removeFrom(b)}var j=h(d.defaults);d.maxBounds&&(j.minZoom=void 0),a(g.width)&&(c(g.width)?f.css("width",g.width+"px"):f.css("width",g.width)),a(g.height)&&(c(g.height)?f.css("height",g.height):f.css("height",g.height+"px"));var k=new L.Map(f[0],{maxZoom:j.maxZoom,minZoom:j.minZoom,doubleClickZoom:j.doubleClickZoom,scrollWheelZoom:j.scrollWheelZoom,attributionControl:j.attributionControl});if(d.leafletMapDeferred.resolve(k),e.setMap(k),a(g.center)||(b.warn("[AngularJS - Leaflet] 'center' is undefined in the current scope, did you forget to initialize it?"),k.setView([j.center.lat,j.center.lng],j.center.zoom)),!a(g.tiles)&&!a(g.layers)){var l=j.tileLayer,m=j.tileLayerOptions,n=L.tileLayer(l,m);n.addTo(k),e.setTile(n)}i(k,j)}}}]),angular.module("leaflet-directive").directive("center",["$log","$parse",function(b,d){return{restrict:"A",scope:!1,replace:!1,transclude:!1,require:"leaflet",link:function(e,f,i,j){var k=h(e.defaults),l=e.center;j.getMap().then(function(f){function h(a){if(e.bounds){var b=a.getBounds(),c=b.getSouthWest(),d=b.getNorthEast();e.bounds={southWest:{lat:c.lat,lng:c.lng},northEast:{lat:d.lat,lng:d.lng}}}}function i(a,b){a.setView([b.lat,b.lng],b.zoom),h(a)}function j(b){return a(b)&&c(b.lat)&&c(b.lng)&&c(b.zoom)}function m(c,f,h){if(a(f)){f.autoDiscover===!0&&c.locate({setView:!0,maxZoom:h.maxZoom});var k={lat:d("center.lat"),lng:d("center.lng"),zoom:d("center.zoom")}}var l=!1;e.$watch("center",function(a){return j(a)?(l||i(c,a),void 0):(b.warn("[AngularJS - Leaflet] invalid 'center'"),i(c,h.center),void 0)},!0),c.on("movestart",function(){l=!0}),c.on("moveend",function(){l=!1,g(e,function(a){k&&(k.lat.assign(a,c.getCenter().lat),k.lng.assign(a,c.getCenter().lng),k.zoom.assign(a,c.getZoom())),a.$emit("centerUpdated")})})}m(f,l,k)})}}}]),angular.module("leaflet-directive").directive("tiles",["$log","leafletData",function(a,b){return{restrict:"A",scope:!1,replace:!1,transclude:!1,require:"leaflet",link:function(a,c,d,e){var f=h(a.defaults),g=a.tiles;e.getMap().then(function(c){var d,e=f.tileLayer,h=f.tileLayerOptions;b.setTile(d),angular.isDefined(g.url)&&(e=g.url),angular.isDefined(g.options)&&angular.copy(g.options,h),a.$watch("tiles.url",function(a){angular.isDefined(a)&&d.setUrl(a)}),d=L.tileLayer(e,h),b.setTile(d),d.addTo(c)})}}}]),angular.module("leaflet-directive").directive("legend",["$log",function(a){return{restrict:"A",scope:!1,replace:!1,transclude:!1,require:"leaflet",link:function(b,c,d,f){f.getMap().then(function(c){var d=b.legend;if(e(d.colors)&&e(d.labels)&&d.colors.length===d.labels.length){var f=d.legendClass?d.legendClass:"legend",g=d.position||"bottomright",h=L.control({position:g});h.onAdd=function(){for(var a=L.DomUtil.create("div",f),b=0;b<d.colors.length;b++)a.innerHTML+='<div><i style="background:'+d.colors[b]+'"></i>'+d.labels[b]+"</div>";return a},h.addTo(c)}else a.warn("[AngularJS - Leaflet] legend.colors and legend.labels must be set.")})}}}]),angular.module("leaflet-directive").directive("geojson",["$log","$rootScope",function(b,c){return{restrict:"A",scope:!1,replace:!1,transclude:!1,require:"leaflet",link:function(b,d,e,f){f.getMap();var h;f.getMap().then(function(d){b.$watch("geojson",function(e){if(a(e)&&(a(h)&&d.removeLayer(b.leaflet.geojson),a(e.data))){var f=e.resetStyleOnMouseout;h=L.geoJson(e.data,{style:e.style,onEachFeature:function(a,d){d.on({mouseover:function(d){g(b,function(){e.selected=a,c.$broadcast("leafletDirectiveMap.geojsonMouseover",d)})},mouseout:function(a){f&&h.resetStyle(a.target),g(b,function(){e.selected=void 0,c.$broadcast("leafletDirectiveMap.geojsonMouseout",a)})},click:function(a){g(b,function(){c.$broadcast("leafletDirectiveMap.geojsonClick",e.selected,a)})}})}}).addTo(d)}})})}}}]),angular.module("leaflet-directive").directive("layers",["$log","leafletData",function(b,c){return{restrict:"A",scope:!1,replace:!1,transclude:!1,require:"leaflet",controller:["$scope",function(a){this.getLayers=function(){return a.leafletLayers}}],link:function(e,f,g,i){var k=h(e.defaults),l=e.layers;i.getMap().then(function(f){function g(d,f,g){if(a(f)){if(!a(f.baselayers)||Object.keys(e.layers.baselayers).length<=0)return b.error("[AngularJS - Leaflet] At least one baselayer has to be defined"),void 0;e.leafletLayers={},c.setLayers(e.leafletLayers),e.leafletLayers.baselayers={},e.leafletLayers.controls={},e.leafletLayers.controls.layers=new L.control.layers,e.leafletLayers.controls.layers.setPosition(g.controlLayersPosition),e.leafletLayers.controls.layers.addTo(d);var i=!1;for(var j in f.baselayers){var k=h(f.baselayers[j]);null!==k&&(e.leafletLayers.baselayers[j]=k,f.baselayers[j].top===!0&&(d.addLayer(e.leafletLayers.baselayers[j]),i=!0),e.leafletLayers.controls.layers.addBaseLayer(e.leafletLayers.baselayers[j],f.baselayers[j].name))}!i&&Object.keys(e.leafletLayers.baselayers).length>0&&d.addLayer(e.leafletLayers.baselayers[Object.keys(f.baselayers)[0]]),e.leafletLayers.overlays={};for(j in f.overlays){var l=h(f.overlays[j]);null!==l&&(e.leafletLayers.overlays[j]=l,f.overlays[j].visible===!0&&d.addLayer(e.leafletLayers.overlays[j]),e.leafletLayers.controls.layers.addOverlay(e.leafletLayers.overlays[j],f.overlays[j].name))}e.$watch("layers.baselayers",function(a){for(var c in e.leafletLayers.baselayers)void 0===a[c]&&(e.leafletLayers.controls.layers.removeLayer(e.leafletLayers.baselayers[c]),d.hasLayer(e.leafletLayers.baselayers[c])&&d.removeLayer(e.leafletLayers.baselayers[c]),delete e.leafletLayers.baselayers[c]);for(var g in a)if(void 0===e.leafletLayers.baselayers[g]){var i=h(a[g]);null!==i&&(e.leafletLayers.baselayers[g]=i,a[g].top===!0&&d.addLayer(e.leafletLayers.baselayers[g]),e.leafletLayers.controls.layers.addBaseLayer(e.leafletLayers.baselayers[g],a[g].name))}if(Object.keys(e.leafletLayers.baselayers).length<=0)b.error("[AngularJS - Leaflet] At least one baselayer has to be defined");else{var j=!1;for(var k in e.leafletLayers.baselayers)if(d.hasLayer(e.leafletLayers.baselayers[k])){j=!0;break}j||d.addLayer(e.leafletLayers.baselayers[Object.keys(f.baselayers)[0]])}},!0),e.$watch("layers.overlays",function(a){for(var b in e.leafletLayers.overlays)void 0===a[b]&&(e.leafletLayers.controls.layers.removeLayer(e.leafletLayers.overlays[b]),d.hasLayer(e.leafletLayers.overlays[b])&&d.removeLayer(e.leafletLayers.overlays[b]),delete e.leafletLayers.overlays[b]);for(var c in a)if(void 0===e.leafletLayers.overlays[c]){var f=h(a[c]);null!==f&&(e.leafletLayers.overlays[c]=f,e.leafletLayers.controls.layers.addOverlay(e.leafletLayers.overlays[c],a[c].name),a[c].visible===!0&&d.addLayer(e.leafletLayers.overlays[c]))}},!0)}}function h(a){if(!d(a.type))return b.error("[AngularJS - Leaflet] A base layer must have a type"),null;if("xyz"!==a.type&&"wms"!==a.type&&"group"!==a.type&&"markercluster"!==a.type&&"google"!==a.type&&"bing"!==a.type)return b.error('[AngularJS - Leaflet] A layer must have a valid type: "xyz, wms, group, google"'),null;if(("xyz"===a.type||"wms"===a.type)&&!d(a.url))return b.error("[AngularJS - Leaflet] A base layer must have an url"),null;if(!d(a.name))return b.error("[AngularJS - Leaflet] A base layer must have a name"),null;(void 0===a.layerParams||null===a.layerParams||"object"!=typeof a.layerParams)&&(a.layerParams={}),(void 0===a.layerOptions||null===a.layerOptions||"object"!=typeof a.layerOptions)&&(a.layerOptions={});var c=null;for(var e in a.layerParams)a.layerOptions[e]=a.layerParams[e];switch(a.type){case"xyz":c=i(a.url,a.layerOptions);break;case"wms":c=m(a.url,a.layerOptions);break;case"group":c=n();break;case"markercluster":c=o(a.layerOptions);break;case"google":c=p(a.layerType,a.layerOptions);break;case"bing":c=q(a.bingKey,a.layerOptions);break;default:c=null}return c}function i(a,b){var c=L.tileLayer(a,b);return c}function m(a,b){var c=L.tileLayer.wms(a,b);return c}function n(){var a=L.layerGroup();return a}function o(a){if(j.MarkerClusterPlugin.isLoaded()){var b=new L.MarkerClusterGroup(a);return b}return null}function p(a,b){if(a=a||"SATELLITE",j.GoogleLayerPlugin.isLoaded()){var c=new L.Google(a,b);return c}return null}function q(a,b){if(j.BingLayerPlugin.isLoaded()){var c=new L.BingLayer(a,b);return c}return null}g(f,l,k)})}}}]),angular.module("leaflet-directive").directive("bounds",["$log",function(b){return{restrict:"A",scope:!1,replace:!1,transclude:!1,require:"leaflet",link:function(d,e,f,g){g.getMap().then(function(e){function f(b){return a(b)&&a(b.southWest)&&a(b.northEast)&&c(b.southWest.lat)&&c(b.southWest.lng)&&c(b.northEast.lat)&&c(b.northEast.lng)}function g(c){d.$watch("bounds",function(d){if(!a(d)||!f(d))return b.error("[AngularJS - Leaflet] Invalid bounds"),void 0;var e=d.southWest,g=d.northEast,h=new L.LatLngBounds(new L.LatLng(e.lat,e.lng),new L.LatLng(g.lat,g.lng));c.getBounds().equals(h)||c.fitBounds(h)},!0)}g(e)})}}}]),angular.module("leaflet-directive").directive("marker",["$log","$rootScope","leafletData",function(c,e,f){return{restrict:"A",scope:!1,replace:!1,transclude:!1,require:["leaflet","?layers"],link:function(i,k,l,m){var n=h(i.defaults),o=m[0];o.getMap().then(function(h){function k(b,c){if(a(c)){var d=l("marker",c,b);f.setMainMarker(d),d.on("click",function(){g(i,function(){e.$broadcast("leafletDirectiveMainMarkerClick")})})}}function l(f,h,k){function l(a,b){return function(c){var d="leafletDirectiveMarker."+a,j=f.replace("markers.","");"click"===a?g(i,function(){e.$broadcast("leafletDirectiveMarkersClick",j)}):"dragend"===a&&(g(i,function(){h.lat=m.getLatLng().lat,h.lng=m.getLatLng().lng}),h.message&&h.focus===!0&&m.openPopup()),g(i,function(a){"emit"===b?a.$emit(d,{markerName:j,leafletEvent:c}):e.$broadcast(d,{markerName:j,leafletEvent:c})})}}var m=o(h);if(a(h.layer)){if(!d(h.layer))return c.error("[AngularJS - Leaflet] A layername must be a string"),null;var n=q();if(!b(n))return c.error("[AngularJS - Leaflet] You must add layers to the directive if used in a marker"),null;if(!b(n.overlays))return c.error("[AngularJS - Leaflet] You must add layers overlays to the directive if used in a marker"),null;if(!b(n.overlays[h.layer]))return c.error("[AngularJS - Leaflet] You must use a name of an existing layer"),null;var p=n.overlays[h.layer];if(!(p instanceof L.LayerGroup))return c.error('[AngularJS - Leaflet] A marker can only be added to a layer of type "group"'),null;p.addLayer(m),k.hasLayer(m)&&h.focus===!0&&m.openPopup()}else k.addLayer(m),h.focus===!0&&m.openPopup();var s,t,u=["click","dblclick","mousedown","mouseover","mouseout","contextmenu","dragstart","drag","dragend","move","remove","popupopen","popupclose"],v=[],w="broadcast";if(void 0===i.eventBroadcast||null===i.eventBroadcast)v=u;else if("object"!=typeof i.eventBroadcast)c.warn("[AngularJS - Leaflet] event-broadcast must be an object check your model.");else if(void 0===i.eventBroadcast.marker||null===i.eventBroadcast.marker)v=u;else if("object"!=typeof i.eventBroadcast.marker)c.warn("[AngularJS - Leaflet] event-broadcast.marker must be an object check your model.");else{void 0!==i.eventBroadcast.marker.logic&&null!==i.eventBroadcast.marker.logic&&("emit"!==i.eventBroadcast.marker.logic&&"broadcast"!==i.eventBroadcast.marker.logic?c.warn("[AngularJS - Leaflet] Available event propagation logic are: 'emit' or 'broadcast'."):"emit"===i.eventBroadcast.marker.logic&&(w="emit"));var x=!1,y=!1;if(void 0!==i.eventBroadcast.marker.enable&&null!==i.eventBroadcast.marker.enable&&"object"==typeof i.eventBroadcast.marker.enable&&(x=!0),void 0!==i.eventBroadcast.marker.disable&&null!==i.eventBroadcast.marker.disable&&"object"==typeof i.eventBroadcast.marker.disable&&(y=!0),x&&y)c.warn("[AngularJS - Leaflet] can not enable and disable events at the same time");else if(x||y)if(x)for(s=0;s<i.eventBroadcast.marker.enable.length;s++)t=i.eventBroadcast.marker.enable[s],-1!==v.indexOf(t)?c.warn("[AngularJS - Leaflet] This event "+t+" is already enabled"):-1===u.indexOf(t)?c.warn("[AngularJS - Leaflet] This event "+t+" does not exist"):v.push(t);else for(v=u,s=0;s<i.eventBroadcast.marker.disable.length;s++){t=i.eventBroadcast.marker.disable[s];var z=v.indexOf(t);-1===z?c.warn("[AngularJS - Leaflet] This event "+t+" does not exist or has been already disabled"):v.splice(z,1)}else c.warn("[AngularJS - Leaflet] must enable or disable events")}for(s=0;s<v.length;s++)t=v[s],m.on(t,l(t,w),{eventName:t,scope_watch_name:f});var A=i.$watch(f,function(d,e){if(!a(d)){if(m.closePopup(),b(n)&&a(n.overlays))for(var f in n.overlays)n.overlays[f]instanceof L.LayerGroup&&n.overlays[f].hasLayer(m)&&n.overlays[f].removeLayer(m);return k.removeLayer(m),A(),void 0}if(e){if(void 0===d.layer||null===d.layer||"string"!=typeof d.layer)void 0!==e.layer&&null!==e.layer&&"string"==typeof e.layer&&(void 0!==n.overlays[e.layer]&&n.overlays[e.layer].hasLayer(m)&&(n.overlays[e.layer].removeLayer(m),m.closePopup()),k.hasLayer(m)||k.addLayer(m));else if(void 0===e.layer||null===e.layer||e.layer!==d.layer)if("string"==typeof e.layer&&void 0!==n.overlays[e.layer]&&n.overlays[e.layer].hasLayer(m)&&n.overlays[e.layer].removeLayer(m),m.closePopup(),k.hasLayer(m)&&k.removeLayer(m),void 0!==n.overlays[d.layer]){var g=n.overlays[d.layer];g instanceof L.LayerGroup?(g.addLayer(m),k.hasLayer(m)&&d.focus===!0&&m.openPopup()):c.error('[AngularJS - Leaflet] A marker can only be added to a layer of type "group"')}else c.error("[AngularJS - Leaflet] You must use a name of an existing layer");if(void 0===d.draggable||null===d.draggable||d.draggable!==!0?void 0!==e.draggable&&null!==e.draggable&&e.draggable===!0&&m.dragging&&m.dragging.disable():(void 0===e.draggable||null===e.draggable||e.draggable!==!0)&&(m.dragging?m.dragging.enable():L.Handler.MarkerDrag&&(m.dragging=new L.Handler.MarkerDrag(m),m.options.draggable=!0,m.dragging.enable())),void 0===d.icon||null===d.icon||"object"!=typeof d.icon)void 0!==e.icon&&null!==e.icon&&"object"==typeof e.icon&&(m.setIcon(new r),m.closePopup(),m.unbindPopup(),void 0!==d.message&&null!==d.message&&"string"==typeof d.message&&""!==d.message&&m.bindPopup(d.message));else if(void 0===e.icon||null===e.icon||"object"!=typeof e.icon){var h=!1;m.dragging&&(h=m.dragging.enabled()),j.AwesomeMarkersPlugin.is(d.icon)?m.setIcon(d.icon):j.Leaflet.DivIcon.is(d.icon)||j.Leaflet.Icon.is(d.icon)?m.setIcon(d.icon):m.setIcon(new r(d.icon)),h&&m.dragging.enable(),m.closePopup(),m.unbindPopup(),void 0!==d.message&&null!==d.message&&"string"==typeof d.message&&""!==d.message&&m.bindPopup(d.message)}else if(j.AwesomeMarkersPlugin.is(d.icon)){if(!j.AwesomeMarkersPlugin.equal(d.icon,e.icon)){var i=!1;m.dragging&&(i=m.dragging.enabled()),m.setIcon(d.icon),i&&m.dragging.enable(),m.closePopup(),m.unbindPopup(),void 0!==d.message&&null!==d.message&&"string"==typeof d.message&&""!==d.message&&m.bindPopup(d.message)}}else if(j.Leaflet.DivIcon.is(d.icon)){if(!j.Leaflet.DivIcon.equal(d.icon,e.icon)){var l=!1;m.dragging&&(l=m.dragging.enabled()),m.setIcon(d.icon),l&&m.dragging.enable(),m.closePopup(),m.unbindPopup(),void 0!==d.message&&null!==d.message&&"string"==typeof d.message&&""!==d.message&&m.bindPopup(d.message)}}else if(j.Leaflet.Icon.is(d.icon)){if(!j.Leaflet.Icon.equal(d.icon,e.icon)){var o=!1;m.dragging&&(o=m.dragging.enabled()),m.setIcon(d.icon),o&&m.dragging.enable(),m.closePopup(),m.unbindPopup(),void 0!==d.message&&null!==d.message&&"string"==typeof d.message&&""!==d.message&&m.bindPopup(d.message)}}else if(JSON.stringify(d.icon)!==JSON.stringify(e.icon)){var p=!1;m.dragging&&(p=m.dragging.enabled()),m.setIcon(new r(d.icon)),p&&m.dragging.enable(),m.closePopup(),m.unbindPopup(),void 0!==d.message&&null!==d.message&&"string"==typeof d.message&&""!==d.message&&m.bindPopup(d.message)}if(void 0===d.message||null===d.message||"string"!=typeof d.message||""===d.message?void 0!==e.message&&null!==e.message&&"string"==typeof e.message&&""!==e.message&&(m.closePopup(),m.unbindPopup()):void 0===e.message||null===e.message||"string"!=typeof e.message||""===e.message?(m.bindPopup(d.message),d.focus===!0&&m.openPopup()):d.message!==e.message&&m.setPopupContent(d.message),void 0===d.focus||null===d.focus||d.focus!==!0?void 0!==e.focus&&null!==e.focus&&e.focus===!0&&m.closePopup():(void 0===e.focus||null===e.focus||e.focus!==!0)&&m.openPopup(),void 0===d.lat||null===d.lat||isNaN(d.lat)||"number"!=typeof d.lat||void 0===d.lng||null===d.lng||isNaN(d.lng)||"number"!=typeof d.lng){if(c.warn("There are problems with lat-lng data, please verify your marker model"),null!==n&&void 0!==n.overlays&&null!==n.overlays)for(var q in n.overlays)(n.overlays[q]instanceof L.LayerGroup||j.MarkerClusterPlugin.is(n.overlays[q]))&&n.overlays[q].hasLayer(m)&&n.overlays[q].removeLayer(m);k.removeLayer(m)}else{var s=m.getLatLng();if(s.lat!==d.lat||s.lng!==d.lng){var t=!1;void 0!==d.layer&&null!==d.layer&&"string"==typeof d.layer&&j.MarkerClusterPlugin.is(n.overlays[d.layer])&&(n.overlays[d.layer].removeLayer(m),t=!0),m.setLatLng([d.lat,d.lng]),t&&n.overlays[d.layer].addLayer(m)}}}},!0);return m}function o(a){var b=null;b=a.icon?a.icon:new r;var c={icon:b,draggable:a.draggable?!0:!1};a.title&&(c.title=a.title);var d=new L.marker(a,c);return a.message&&d.bindPopup(a.message),d}var p=i.marker,q=function(){return[]};a(m[1])&&(q=m[1].getLayers);var r=L.Icon.extend({options:{iconUrl:n.icon.url,iconRetinaUrl:n.icon.retinaUrl,iconSize:n.icon.size,iconAnchor:n.icon.anchor,popupAnchor:n.icon.popup,shadowUrl:n.icon.shadow.url,shadowRetinaUrl:n.icon.shadow.retinaUrl,shadowSize:n.icon.shadow.size,shadowAnchor:n.icon.shadow.anchor}});k(h,p)})}}}]),angular.module("leaflet-directive").directive("markers",["$log","$rootScope","leafletData",function(e,f,i){return{restrict:"A",scope:!1,replace:!1,transclude:!1,require:["leaflet","?layers"],link:function(k,l,m,n){var o=h(k.defaults),p=n[0];p.getMap().then(function(h){function l(c,d){var e={};i.setMarkers(e),a(c)&&k.$watch("markers",function(f){for(var g in e)if(!a(f[g])){e[g].closePopup();var h=r();if(b(h)&&a(h.overlays))for(var i in h.overlays)h.overlays[i]instanceof L.LayerGroup&&h.overlays[i].hasLayer(e[g])&&h.overlays[i].removeLayer(e[g]);d.removeLayer(e[g]),delete e[g]}for(var j in f)if(!a(e[j])){var k=m("markers."+j,c[j],d);null!==k&&(e[j]=k)}},!0)}function m(h,i,l){function m(a,b){return function(c){var d="leafletDirectiveMarker."+a,e=h.replace("markers.","");"click"===a?g(k,function(){f.$broadcast("leafletDirectiveMarkersClick",e)}):"dragend"===a&&(g(k,function(){i.lat=n.getLatLng().lat,i.lng=n.getLatLng().lng}),i.message&&i.focus===!0&&n.openPopup()),g(k,function(a){"emit"===b?a.$emit(d,{markerName:e,leafletEvent:c}):f.$broadcast(d,{markerName:e,leafletEvent:c})})}}var n=p(i);if(a(i.layer)){if(!d(i.layer))return e.error("[AngularJS - Leaflet] A layername must be a string"),null;var o=r();if(!b(o))return e.error("[AngularJS - Leaflet] You must add layers to the directive if used in a marker"),null;if(!b(o.overlays))return e.error("[AngularJS - Leaflet] You must add layers overlays to the directive if used in a marker"),null;if(!b(o.overlays[i.layer]))return e.error("[AngularJS - Leaflet] You must use a name of an existing layer"),null;var q=o.overlays[i.layer];if(!(q instanceof L.LayerGroup))return e.error('[AngularJS - Leaflet] A marker can only be added to a layer of type "group"'),null;q.addLayer(n),l.hasLayer(n)&&i.focus===!0&&n.openPopup()}else l.addLayer(n),i.focus===!0&&n.openPopup();var t,u,v=["click","dblclick","mousedown","mouseover","mouseout","contextmenu","dragstart","drag","dragend","move","remove","popupopen","popupclose"],w=[],x="broadcast";if(void 0===k.eventBroadcast||null===k.eventBroadcast)w=v;else if("object"!=typeof k.eventBroadcast)e.warn("[AngularJS - Leaflet] event-broadcast must be an object check your model.");else if(void 0===k.eventBroadcast.marker||null===k.eventBroadcast.marker)w=v;else if("object"!=typeof k.eventBroadcast.marker)e.warn("[AngularJS - Leaflet] event-broadcast.marker must be an object check your model.");else{void 0!==k.eventBroadcast.marker.logic&&null!==k.eventBroadcast.marker.logic&&("emit"!==k.eventBroadcast.marker.logic&&"broadcast"!==k.eventBroadcast.marker.logic?e.warn("[AngularJS - Leaflet] Available event propagation logic are: 'emit' or 'broadcast'."):"emit"===k.eventBroadcast.marker.logic&&(x="emit"));var y=!1,z=!1;if(void 0!==k.eventBroadcast.marker.enable&&null!==k.eventBroadcast.marker.enable&&"object"==typeof k.eventBroadcast.marker.enable&&(y=!0),void 0!==k.eventBroadcast.marker.disable&&null!==k.eventBroadcast.marker.disable&&"object"==typeof k.eventBroadcast.marker.disable&&(z=!0),y&&z)e.warn("[AngularJS - Leaflet] can not enable and disable events at the same time");else if(y||z)if(y)for(t=0;t<k.eventBroadcast.marker.enable.length;t++)u=k.eventBroadcast.marker.enable[t],-1!==w.indexOf(u)?e.warn("[AngularJS - Leaflet] This event "+u+" is already enabled"):-1===v.indexOf(u)?e.warn("[AngularJS - Leaflet] This event "+u+" does not exist"):w.push(u);else for(w=v,t=0;t<k.eventBroadcast.marker.disable.length;t++){u=k.eventBroadcast.marker.disable[t];var A=w.indexOf(u);-1===A?e.warn("[AngularJS - Leaflet] This event "+u+" does not exist or has been already disabled"):w.splice(A,1)}else e.warn("[AngularJS - Leaflet] must enable or disable events")}for(t=0;t<w.length;t++)u=w[t],n.on(u,m(u,x),{eventName:u,scope_watch_name:h});var B=k.$watch(h,function(f,g){if(!b(f)){if(n.closePopup(),b(o)&&a(o.overlays))for(var h in o.overlays)o.overlays[h]instanceof L.LayerGroup&&o.overlays[h].hasLayer(n)&&o.overlays[h].removeLayer(n);return l.removeLayer(n),B(),void 0}if(a(g)){if(d(f.layer)){if(b(g.layer)||g.layer!==f.layer)if("string"==typeof g.layer&&void 0!==o.overlays[g.layer]&&o.overlays[g.layer].hasLayer(n)&&o.overlays[g.layer].removeLayer(n),n.closePopup(),l.hasLayer(n)&&l.removeLayer(n),void 0!==o.overlays[f.layer]){var i=o.overlays[f.layer];i instanceof L.LayerGroup?(i.addLayer(n),l.hasLayer(n)&&f.focus===!0&&n.openPopup()):e.error('[AngularJS - Leaflet] A marker can only be added to a layer of type "group"')}else e.error("[AngularJS - Leaflet] You must use a name of an existing layer")}else d(g.layer)&&(a(o.overlays[g.layer])&&o.overlays[g.layer].hasLayer(n)&&(o.overlays[g.layer].removeLayer(n),n.closePopup()),l.hasLayer(n)||l.addLayer(n));if(void 0===f.draggable||null===f.draggable||f.draggable!==!0?void 0!==g.draggable&&null!==g.draggable&&g.draggable===!0&&n.dragging&&n.dragging.disable():(void 0===g.draggable||null===g.draggable||g.draggable!==!0)&&(n.dragging?n.dragging.enable():L.Handler.MarkerDrag&&(n.dragging=new L.Handler.MarkerDrag(n),n.options.draggable=!0,n.dragging.enable())),void 0===f.icon||null===f.icon||"object"!=typeof f.icon)void 0!==g.icon&&null!==g.icon&&"object"==typeof g.icon&&(n.setIcon(new s),n.closePopup(),n.unbindPopup(),void 0!==f.message&&null!==f.message&&"string"==typeof f.message&&""!==f.message&&n.bindPopup(f.message));else if(void 0===g.icon||null===g.icon||"object"!=typeof g.icon){var k=!1;n.dragging&&(k=n.dragging.enabled()),j.AwesomeMarkersPlugin.is(f.icon)?n.setIcon(f.icon):j.Leaflet.DivIcon.is(f.icon)||j.Leaflet.Icon.is(f.icon)?n.setIcon(f.icon):n.setIcon(new s(f.icon)),k&&n.dragging.enable(),n.closePopup(),n.unbindPopup(),void 0!==f.message&&null!==f.message&&"string"==typeof f.message&&""!==f.message&&n.bindPopup(f.message)}else if(j.AwesomeMarkersPlugin.is(f.icon)){if(!j.AwesomeMarkersPlugin.equal(f.icon,g.icon)){var m=!1;n.dragging&&(m=n.dragging.enabled()),n.setIcon(f.icon),m&&n.dragging.enable(),n.closePopup(),n.unbindPopup(),void 0!==f.message&&null!==f.message&&"string"==typeof f.message&&""!==f.message&&n.bindPopup(f.message)}}else if(j.Leaflet.DivIcon.is(f.icon)){if(!j.Leaflet.DivIcon.equal(f.icon,g.icon)){var p=!1;n.dragging&&(p=n.dragging.enabled()),n.setIcon(f.icon),p&&n.dragging.enable(),n.closePopup(),n.unbindPopup(),void 0!==f.message&&null!==f.message&&"string"==typeof f.message&&""!==f.message&&n.bindPopup(f.message)}}else if(j.Leaflet.Icon.is(f.icon)){if(!j.Leaflet.Icon.equal(f.icon,g.icon)){var q=!1;n.dragging&&(q=n.dragging.enabled()),n.setIcon(f.icon),q&&n.dragging.enable(),n.closePopup(),n.unbindPopup(),void 0!==f.message&&null!==f.message&&"string"==typeof f.message&&""!==f.message&&n.bindPopup(f.message)}}else if(JSON.stringify(f.icon)!==JSON.stringify(g.icon)){var r=!1;n.dragging&&(r=n.dragging.enabled()),n.setIcon(new s(f.icon)),r&&n.dragging.enable(),n.closePopup(),n.unbindPopup(),void 0!==f.message&&null!==f.message&&"string"==typeof f.message&&""!==f.message&&n.bindPopup(f.message)}if(void 0===f.message||null===f.message||"string"!=typeof f.message||""===f.message?void 0!==g.message&&null!==g.message&&"string"==typeof g.message&&""!==g.message&&(n.closePopup(),n.unbindPopup()):void 0===g.message||null===g.message||"string"!=typeof g.message||""===g.message?(n.bindPopup(f.message),f.focus===!0&&n.openPopup()):f.message!==g.message&&n.setPopupContent(f.message),void 0===f.focus||null===f.focus||f.focus!==!0?void 0!==g.focus&&null!==g.focus&&g.focus===!0&&n.closePopup():(void 0===g.focus||null===g.focus||g.focus!==!0)&&n.openPopup(),c(f.lat)&&c(f.lng)){var t=n.getLatLng();if(t.lat!==f.lat||t.lng!==f.lng){var u=!1;d(f.layer)&&j.MarkerClusterPlugin.is(o.overlays[f.layer])&&(o.overlays[f.layer].removeLayer(n),u=!0),n.setLatLng([f.lat,f.lng]),u&&o.overlays[f.layer].addLayer(n)}}else{if(e.warn("There are problems with lat-lng data, please verify your marker model"),b(o)&&b(o.overlays))for(var v in o.overlays)(o.overlays[v]instanceof L.LayerGroup||j.MarkerClusterPlugin.is(o.overlays[v]))&&o.overlays[v].hasLayer(n)&&o.overlays[v].removeLayer(n);l.removeLayer(n)}}},!0);return n}function p(a){var b=null;b=a.icon?a.icon:new s;var c={icon:b,draggable:a.draggable?!0:!1};a.title&&(c.title=a.title);var d=new L.marker(a,c);return a.message&&d.bindPopup(a.message),d}var q=k.markers,r=function(){return[]};a(n[1])&&(r=n[1].getLayers);var s=L.Icon.extend({options:{iconUrl:o.icon.url,iconRetinaUrl:o.icon.retinaUrl,iconSize:o.icon.size,iconAnchor:o.icon.anchor,popupAnchor:o.icon.popup,shadowUrl:o.icon.shadow.url,shadowRetinaUrl:o.icon.shadow.retinaUrl,shadowSize:o.icon.shadow.size,shadowAnchor:o.icon.shadow.anchor}});l(q,h)})}}}]),angular.module("leaflet-directive").directive("paths",["$log","leafletData",function(b,c){return{restrict:"A",scope:!1,replace:!1,transclude:!1,require:"leaflet",link:function(b,d,e,f){var g=h(b.defaults),i=b.paths;f.getMap().then(function(d){function e(d,e,g){var h={};c.setPaths(h),a(d)&&b.$watch("paths",function(b){for(var c in b)a(h[c])||(h[c]=f(c,b[c],e,g));for(var d in h)a(b[d])||delete h[d]},!0)}function f(c,d,e,f){function g(b){if(a(b.latlngs))switch(b.type){default:case"polyline":case"polygon":i.setLatLngs(j(b.latlngs));break;case"multiPolyline":case"multiPolygon":i.setLatLngs(k(b.latlngs));break;case"rectangle":i.setBounds(new L.LatLngBounds(j(b.latlngs)));break;case"circle":case"circleMarker":i.setLatLng(h(b.latlngs)),a(b.radius)&&i.setRadius(b.radius)}a(b.weight)&&i.setStyle({weight:b.weight}),a(b.color)&&i.setStyle({color:b.color}),a(b.opacity)&&i.setStyle({opacity:b.opacity})
}var i,l={weight:f.path.weight,color:f.path.color,opacity:f.path.opacity};switch(a(d.stroke)&&(l.stroke=d.stroke),a(d.fill)&&(l.fill=d.fill),a(d.fillColor)&&(l.fillColor=d.fillColor),a(d.fillOpacity)&&(l.fillOpacity=d.fillOpacity),a(d.smoothFactor)&&(l.smoothFactor=d.smoothFactor),a(d.noClip)&&(l.noClip=d.noClip),a(d.type)||(d.type="polyline"),d.type){default:case"polyline":i=new L.Polyline([],l);break;case"multiPolyline":i=new L.multiPolyline([[[0,0],[1,1]]],l);break;case"polygon":i=new L.Polygon([],l);break;case"multiPolygon":i=new L.MultiPolygon([[[0,0],[1,1],[0,1]]],l);break;case"rectangle":i=new L.Rectangle([[0,0],[1,1]],l);break;case"circle":i=new L.Circle([0,0],1,l);break;case"circleMarker":i=new L.CircleMarker([0,0],l)}e.addLayer(i);var m=b.$watch("paths."+c,function(b){return a(b)?(g(b),void 0):(e.removeLayer(i),m(),void 0)},!0);return i}function h(a){return new L.LatLng(a.lat,a.lng)}function j(a){return a.filter(function(a){return!!a.lat&&!!a.lng}).map(function(a){return new L.LatLng(a.lat,a.lng)})}function k(a){return a.map(function(a){return j(a)})}e(i,d,g)})}}}]),angular.module("leaflet-directive").directive("eventBroadcast",["$log","$rootScope",function(a,b){return{restrict:"A",scope:!1,replace:!1,transclude:!1,require:"leaflet",link:function(c,d,e,f){function h(){function d(a,d){return function(e){var f="leafletDirectiveMap."+a;g(c,function(a){"emit"===d?a.$emit(f,{leafletEvent:e}):"broadcast"===d&&b.$broadcast(f,{leafletEvent:e})})}}var e,f,h=["click","dblclick","mousedown","mouseup","mouseover","mouseout","mousemove","contextmenu","focus","blur","preclick","load","unload","viewreset","movestart","move","moveend","dragstart","drag","dragend","zoomstart","zoomend","zoomlevelschange","resize","autopanstart","layeradd","layerremove","baselayerchange","overlayadd","overlayremove","locationfound","locationerror","popupopen","popupclose"],i=[],k="broadcast";if(void 0===c.eventBroadcast||null===c.eventBroadcast)i=h;else if("object"!=typeof c.eventBroadcast)a.warn("[AngularJS - Leaflet] event-broadcast must be an object check your model.");else if(void 0===c.eventBroadcast.map||null===c.eventBroadcast.map)i=h;else if("object"!=typeof c.eventBroadcast.map)a.warn("[AngularJS - Leaflet] event-broadcast.map must be an object check your model.");else{void 0!==c.eventBroadcast.map.logic&&null!==c.eventBroadcast.map.logic&&("emit"!==c.eventBroadcast.map.logic&&"broadcast"!==c.eventBroadcast.map.logic?a.warn("[AngularJS - Leaflet] Available event propagation logic are: 'emit' or 'broadcast'."):"emit"===c.eventBroadcast.map.logic&&(k="emit"));var l=!1,m=!1;if(void 0!==c.eventBroadcast.map.enable&&null!==c.eventBroadcast.map.enable&&"object"==typeof c.eventBroadcast.map.enable&&(l=!0),void 0!==c.eventBroadcast.map.disable&&null!==c.eventBroadcast.map.disable&&"object"==typeof c.eventBroadcast.map.disable&&(m=!0),l&&m)a.warn("[AngularJS - Leaflet] can not enable and disable events at the time");else if(l||m)if(l)for(e=0;e<c.eventBroadcast.map.enable.length;e++)f=c.eventBroadcast.map.enable[e],-1!==i.indexOf(f)?a.warn("[AngularJS - Leaflet] This event "+f+" is already enabled"):-1===h.indexOf(f)?a.warn("[AngularJS - Leaflet] This event "+f+" does not exist"):i.push(f);else for(i=h,e=0;e<c.eventBroadcast.map.disable.length;e++){f=c.eventBroadcast.map.disable[e];var n=i.indexOf(f);-1===n?a.warn("[AngularJS - Leaflet] This event "+f+" does not exist or has been already disabled"):i.splice(n,1)}else a.warn("[AngularJS - Leaflet] must enable or disable events")}for(e=0;e<i.length;e++)f=i[e],j.on(f,d(f,k),{eventName:f})}function i(){if("object"!=typeof c.events)return!1;for(var a in c.events)j.on(a,c.events[a])}var j=f.getMap();c.legend,i(),h()}}}]),angular.module("leaflet-directive").directive("maxbounds",["$log",function(){return{restrict:"A",scope:!1,replace:!1,transclude:!1,require:"leaflet",link:function(b,d,e,f){function g(d,e){a(e.southWest)&&a(e.northEast)&&b.$watch("maxBounds",function(b){a(b.southWest)&&a(b.northEast)&&c(b.southWest.lat)&&c(b.southWest.lng)&&c(b.northEast.lat)&&c(b.northEast.lng)&&d.setMaxBounds(new L.LatLngBounds(new L.LatLng(b.southWest.lat,b.southWest.lng),new L.LatLng(b.northEast.lat,b.northEast.lng)))})}h(b.defaults);var i=f.getMap(),j=b.maxBounds;g(i,j)}}}]),angular.module("leaflet-directive").service("leafletData",["$log","$q",function(a,b){var c,d,e=b.defer(),f=b.defer(),g=b.defer(),h=b.defer();this.setMap=function(a){c=a},this.getMap=function(){return c},this.getPaths=function(){return f.promise},this.setPaths=function(a){f.resolve(a)},this.getMarkers=function(){return h.promise},this.setMarkers=function(a){h.resolve(a)},this.getLayers=function(){return e.promise},this.setLayers=function(a){e.resolve(a)},this.setTile=function(a){d=a},this.getTile=function(){return d},this.setMainMarker=function(a){g.resolve(a)},this.getMainMarker=function(){return g.promise}}])}();