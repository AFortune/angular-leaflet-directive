/*! angular-leaflet-directive 15-05-2013 */
var leafletDirective=angular.module("leaflet-directive",[]);leafletDirective.directive("leaflet",["$http","$log",function(e,a){return{restrict:"E",replace:!0,transclude:!0,scope:{center:"=center",tilelayer:"=tilelayer",markers:"=markers",leafletMarkers:"=leafletMarkers",path:"=path",maxZoom:"@maxzoom"},template:'<div class="angular-leaflet-map"></div>',link:function(e,t,r){var n=t[0],l=new L.Map(n);r.map&&(e.map=l),r.maxzoom&&(e.maxZoom=parseInt(r.maxzoom,10)),l.setView([0,0],1);var o=e.tilelayer||"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",i=e.maxZoom||12;if(L.tileLayer(o,{maxZoom:i}).addTo(l),r.center&&e.center&&(e.center.lat&&e.center.lng&&e.center.zoom?l.setView([e.center.lat,e.center.lng],e.center.zoom):e.center.autoDiscover===!0&&l.locate({setView:!0,maxZoom:i}),l.on("dragend",function(){e.$apply(function(e){e.center.lat=l.getCenter().lat,e.center.lng=l.getCenter().lng})}),l.on("zoomend",function(){e.center.zoom!==l.getZoom()&&e.$apply(function(e){e.center.zoom=l.getZoom()})}),e.$watch("center",function(e){e.lat&&e.lng&&e.zoom&&l.setView([e.lat,e.lng],e.zoom)},!0)),r.markers&&e.markers){var c=function(e,a){var t=a.markers[e],n=new L.marker(a.markers[e],{draggable:t.draggable?!0:!1});return n.on("dragend",function(){a.$apply(function(){t.lat=n.getLatLng().lat,t.lng=n.getLatLng().lng,t.message&&n.openPopup()})}),a.$watch("markers."+e,function(t,o){return t?(void 0!==t.draggable&&t.draggable!==o.draggable&&(t.draggable===!0?n.dragging.enable():n.dragging.disable()),void 0!==t.focus&&t.focus!==o.focus&&(t.focus===!0?n.openPopup():n.closePopup()),void 0!==t.message&&t.message!==o.message&&n.bindPopup(t),(t.lat!==o.lat||t.lng!==o.lng)&&n.setLatLng(new L.LatLng(t.lat,t.lng)),void 0):(l.removeLayer(markers[e]),delete g[e],r.leafletMarkers&&delete a.leafletMarkers[e],void 0)},!0),n},g={};r.leafletMarkers&&(e.leafletMarkers={});for(var s in e.markers){var m=c(s,e);l.addLayer(m),g[s]=m,r.leafletMarkers&&(e.leafletMarkers[s]=m)}e.$watch("markers",function(a){for(var t in a)if(void 0===g[t]){var n=c(t,e);l.addLayer(n),g[t]=n,r.leafletMarkers&&(e.leafletMarkers[t]=n)}},!0)}if(r.path){var d=new L.Polyline([],{weight:10,opacity:1});l.addLayer(d),e.$watch("path.latlngs",function(e){for(var t=0,r=e.length;r>t;t++)(void 0===e[t]||void 0===e[t].lat||void 0===e[t].lng)&&(a.warn("Bad path point inn the $scope.path array "),e.splice(t,1));d.setLatLngs(e)},!0),e.$watch("path.weight",function(e){d.setStyle({weight:e})},!0),e.$watch("path.color",function(e){d.setStyle({color:e})},!0)}}}}]);