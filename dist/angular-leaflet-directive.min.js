/*! angular-leaflet-directive 07-05-2013 */
var leafletDirective=angular.module("leaflet-directive",[]);leafletDirective.directive("leaflet",function(e,t){return{restrict:"E",replace:!0,transclude:!0,scope:{center:"=center",tilelayer:"=tilelayer",markers:"=markers",path:"=path"},template:'<div class="angular-leaflet-map"></div>',link:function(e,a,n){var r=a[0],o=new L.Map(r),c=12;e.maxZoom&&(c=e.maxZoom);var i=new L.LatLng(0,0);o.setView(i,1),o.locate({setView:!0,maxZoom:c});var l=e.tilelayer||"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png";if(L.tileLayer(l,{maxZoom:c}).addTo(o),n.center){e.$watch("center",function(t){if(void 0!==t){t=new L.LatLng(e.center.lat,e.center.lng);var a=e.center.zoom||8;o.setView(t,a)}});var g=!1;o.on("dragstart",function(){g=!0}),o.on("drag",function(){e.$apply(function(e){e.center.lat=o.getCenter().lat,e.center.lng=o.getCenter().lng})}),o.on("dragend",function(){g=!1}),e.$watch("center.lng",function(e){g||o.setView(new L.LatLng(o.getCenter().lat,e),o.getZoom())}),e.$watch("center.lat",function(e){g||o.setView(new L.LatLng(e,o.getCenter().lng),o.getZoom())});var s=!1;o.on("zoomstart",function(){s=!0}),e.$watch("center.zoom",function(t){s||e.$$phase||o.setZoom(t)}),o.on("zoomend",function(){void 0!==e.center&&void 0!==e.center.zoom&&(e.$$phase||(e.$apply(function(e){e.center.zoom=o.getZoom()}),s=!1))})}if(void 0!==n.markers){var m=[],f=function(e,t){var a=t.markers[e],n=new L.marker(t.markers[e],{draggable:a.draggable?!0:!1});if(a.message&&(t.$watch("markers."+e+".message",function(){n.bindPopup(a.message)}),t.$watch("markers."+e+".focus",function(e){e&&n.openPopup()})),a.draggable){var r=!1;n.on("dragstart",function(){r=!0}),n.on("drag",function(){t.$apply(function(){a.lat=n.getLatLng().lat,a.lng=n.getLatLng().lng})}),n.on("dragend",function(){r=!1,a.message&&n.openPopup()}),t.$watch("markers."+e,function(){n.setLatLng(t.markers[e])},!0),t.$watch("markers"+e+".lng",function(e){!r&&e&&n.setLatLng(new L.LatLng(n.getLatLng().lat,e))}),t.$watch("markers"+e+".lat",function(e){!r&&e&&n.setLatLng(new L.LatLng(e,n.getLatLng().lng))})}return n};e.$watch("markers",function(){for(var t in m)e.markers[t]||o.removeLayer(m[t]);for(var a in e.markers)if(void 0===m[a]){var n=f(a,e);o.addLayer(n),m[a]=n}},!0)}if(n.path){var p=new L.Polyline([],{});o.addLayer(p),e.$watch("path",function(a){for(var n=a.latlngs,r=0,o=n.length;o>r;r++)(void 0===n[r]||void 0===n[r].lat||void 0===n[r].lng)&&(t.warn("Bad path point inn the $scope.path array "),n.splice(r,1));p.setLatLngs(n),p.setStyle({smoothFactor:e.path.smoothFactor,color:e.path.color})},!0)}}}});