/*! angular-leaflet-directive 12-05-2013 */
var leafletDirective=angular.module("leaflet-directive",[]);leafletDirective.directive("leaflet",["$http","$log",function(e,t){return{restrict:"E",replace:!0,transclude:!0,scope:{center:"=center",tilelayer:"=tilelayer",markers:"=markers",path:"=path",maxZoom:"@maxzoom"},template:'<div class="angular-leaflet-map"></div>',link:function(e,a,n){var r=a[0],o=new L.Map(r);n.map&&(e.map=o),o.setView([0,0],1);var l=e.tilelayer||"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",i=e.maxZoom||12;if(L.tileLayer(l,{maxZoom:i}).addTo(o),n.center&&e.center&&(e.center.lat&&e.center.lng&&e.center.zoom?o.setView(new L.LatLng(e.center.lat,e.center.lng),e.center.zoom):e.center.autoDiscover===!0&&o.locate({setView:!0,maxZoom:i}),o.on("dragend",function(){e.$apply(function(e){e.center.lat=o.getCenter().lat,e.center.lng=o.getCenter().lng})}),o.on("zoomend",function(){e.$apply(function(e){e.center.zoom=o.getZoom()})}),e.$watch("center",function(e){o.setView([e.lat,e.lng],e.zoom)},!0)),void 0!==n.markers){var c=[],g=function(e,t){var a=t.markers[e],n=new L.marker(t.markers[e],{draggable:a.draggable?!0:!1});return a.message&&(t.$watch("markers."+e+".message",function(){n.bindPopup(a.message)}),t.$watch("markers."+e+".focus",function(e){e&&n.openPopup()})),t.$watch("markers."+e+".draggable",function(e){e===!1?n.dragging.disable():e===!0&&n.dragging.enable()}),n.on("dragend",function(){t.$apply(function(){a.lat=n.getLatLng().lat,a.lng=n.getLatLng().lng,a.message&&n.openPopup()})}),t.$watch("markers."+e,function(){n.setLatLng(t.markers[e])},!0),t.$watch("markers"+e+".lng",function(e){e&&n.setLatLng(new L.LatLng(n.getLatLng().lat,e))}),t.$watch("markers"+e+".lat",function(e){e&&n.setLatLng(new L.LatLng(e,n.getLatLng().lng))}),n};e.$watch("markers",function(){for(var t in c)e.markers[t]||(o.removeLayer(c[t]),delete c[t]);for(var a in e.markers)if(void 0===c[a]){var n=g(a,e);o.addLayer(n),c[a]=n}},!0)}if(n.path){var s=new L.Polyline([],{weight:10,opacity:1});o.addLayer(s),e.$watch("path.latlngs",function(e){for(var a=0,n=e.length;n>a;a++)(void 0===e[a]||void 0===e[a].lat||void 0===e[a].lng)&&(t.warn("Bad path point inn the $scope.path array "),e.splice(a,1));s.setLatLngs(e)},!0),e.$watch("path.weight",function(e){s.setStyle({weight:e})},!0),e.$watch("path.color",function(e){s.setStyle({color:e})},!0)}}}}]);