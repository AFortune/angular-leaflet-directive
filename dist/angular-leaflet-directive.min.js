/*! angular-leaflet-directive 08-05-2013 */
var leafletDirective=angular.module("leaflet-directive",[]);leafletDirective.directive("leaflet",function(e,t){return{restrict:"E",replace:!0,transclude:!0,scope:{center:"=center",tilelayer:"=tilelayer",markers:"=markers",path:"=path"},template:'<div class="angular-leaflet-map"></div>',link:function(e,a,n){var r=a[0],o=new L.Map(r),i=12;e.maxZoom&&(i=e.maxZoom);var c=new L.LatLng(0,0);o.setView(c,1),o.locate({setView:!0,maxZoom:i});var g=e.tilelayer||"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png";if(L.tileLayer(g,{maxZoom:i}).addTo(o),n.center){e.$watch("center",function(t){if(void 0!==t){t=new L.LatLng(e.center.lat,e.center.lng);var a=e.center.zoom||8;o.setView(t,a)}});var l=!1;o.on("dragstart",function(){l=!0}),o.on("drag",function(){e.$apply(function(e){e.center.lat=o.getCenter().lat,e.center.lng=o.getCenter().lng})}),o.on("dragend",function(){l=!1}),e.$watch("center.lng",function(e){l||o.setView(new L.LatLng(o.getCenter().lat,e),o.getZoom())}),e.$watch("center.lat",function(e){l||o.setView(new L.LatLng(e,o.getCenter().lng),o.getZoom())});var s=!1;o.on("zoomstart",function(){s=!0}),e.$watch("center.zoom",function(t){!s&&t&&(e.$$phase||o.setZoom(t))}),o.on("zoomend",function(){void 0!==e.center&&void 0!==e.center.zoom&&(e.$$phase||(e.$apply(function(e){e.center.zoom=o.getZoom()}),s=!1))})}if(void 0!==n.markers){var m=[],f=function(e,t){var a=t.markers[e],n=new L.marker(t.markers[e],{draggable:a.draggable?!0:!1});a.message&&(t.$watch("markers."+e+".message",function(){n.bindPopup(a.message)}),t.$watch("markers."+e+".focus",function(e){e&&n.openPopup()})),t.$watch("markers."+e+".draggable",function(e){e===!1?n.dragging.disable():n.dragging.enable()});var r=!1;return n.on("dragstart",function(){r=!0}),n.on("drag",function(){t.$apply(function(){a.lat=n.getLatLng().lat,a.lng=n.getLatLng().lng})}),n.on("dragend",function(){r=!1,a.message&&n.openPopup()}),t.$watch("markers."+e,function(){n.setLatLng(t.markers[e])},!0),t.$watch("markers"+e+".lng",function(e){!r&&e&&n.setLatLng(new L.LatLng(n.getLatLng().lat,e))}),t.$watch("markers"+e+".lat",function(e){!r&&e&&n.setLatLng(new L.LatLng(e,n.getLatLng().lng))}),n};e.$watch("markers",function(){for(var t in m)e.markers[t]||o.removeLayer(m[t]);for(var a in e.markers)if(void 0===m[a]){var n=f(a,e);o.addLayer(n),m[a]=n}},!0)}if(n.path){var u=new L.Polyline([],{weight:10,opacity:1});o.addLayer(u),e.$watch("path.latlngs",function(e){for(var a=0,n=e.length;n>a;a++)(void 0===e[a]||void 0===e[a].lat||void 0===e[a].lng)&&(t.warn("Bad path point inn the $scope.path array "),e.splice(a,1));u.setLatLngs(e)},!0),e.$watch("path.weight",function(e){u.setStyle({weight:e})},!0),e.$watch("path.color",function(e){u.setStyle({color:e})},!0)}}}});