/**!
 * The MIT License
 *
 * Copyright (c) 2013 the angular-leaflet-directive team, http://tombatossals.github.io/angular-leaflet-directive
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 *
 * angular-google-maps
 * https://github.com/tombatossals/angular-leaflet-directive
 *
 * @authors https://github.com/tombatossals/angular-leaflet-directive/graphs/contributors
 */

/*! angular-leaflet-directive 20-10-2013 */
!function(){"use strict";function a(a){return angular.isDefined(a)}function b(a){return angular.isNumber(a)}function c(a){return angular.isString(a)}function d(a){return angular.isArray(a)}function e(a,b){return angular.equals(a,b)}function f(a){var b=a.$root.$$phase;return!("$apply"===b||"$digest"===b)}function g(a,b){f(a)?a.$apply(b):a.$eval(b)}function h(b){var c=i();return a(b)&&(c.maxZoom=a(b.maxZoom)?parseInt(b.maxZoom,10):c.maxZoom,c.minZoom=a(b.minZoom)?parseInt(b.minZoom,10):c.minZoom,c.doubleClickZoom=a(b.doubleClickZoom)&&b.doubleClickZoom?!0:!1,c.scrollWheelZoom=a(b.scrollWheelZoom)&&b.scrollWheelZoom?!0:!1,c.attributionControl=a(b.attributionControl)&&b.attributionControl?!0:!1,c.tileLayer=a(b.tileLayer)?b.tileLayer:c.tileLayer,b.tileLayerOptions&&angular.copy(b.tileLayerOptions,c.tileLayerOptions)),c}function i(){return{maxZoom:14,minZoom:1,doubleClickZoom:!0,scrollWheelZoom:!0,zoomControl:!0,attributionControl:!0,zoomsliderControl:!1,controlLayersPosition:"topright",tileLayer:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",tileLayerOptions:{attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'},path:{weight:10,opacity:1,color:"#0000ff"},center:{lat:0,lng:0,zoom:1}}}var j={AwesomeMarkersPlugin:{isLoaded:function(){return void 0!==L.AwesomeMarkers?void 0!==L.AwesomeMarkers.Icon:!1},is:function(a){return this.isLoaded()?a instanceof L.AwesomeMarkers.Icon:!1},equal:function(a,b){return this.isLoaded?this.is(a)&&this.is(b)?a.options.icon===b.options.icon&&a.options.iconColor===b.options.iconColor&&a.options.color===b.options.color&&a.options.iconSize[0]===b.options.iconSize[0]&&a.options.iconSize[1]===b.options.iconSize[1]&&a.options.iconAnchor[0]===b.options.iconAnchor[0]&&a.options.iconAnchor[1]===b.options.iconAnchor[1]&&a.options.popupAnchor[0]===b.options.popupAnchor[0]&&a.options.popupAnchor[1]===b.options.popupAnchor[1]&&a.options.shadowAnchor[0]===b.options.shadowAnchor[0]&&a.options.shadowAnchor[1]===b.options.shadowAnchor[1]&&a.options.shadowSize[0]===b.options.shadowSize[0]&&a.options.shadowSize[1]===b.options.shadowSize[1]:!1:!1}},MarkerClusterPlugin:{isLoaded:function(){return void 0!==L.MarkerClusterGroup},is:function(a){return this.isLoaded()?a instanceof L.MarkerClusterGroup:!1}},GoogleLayerPlugin:{isLoaded:function(){return void 0!==L.Google},is:function(a){return this.isLoaded()?a instanceof L.Google:!1}},BingLayerPlugin:{isLoaded:function(){return void 0!==L.BingLayer},is:function(a){return this.isLoaded()?a instanceof L.BingLayer:!1}},Leaflet:{DivIcon:{is:function(a){return a instanceof L.DivIcon},equal:function(a,b){return this.is(a)&&this.is(b)?a.options.html===b.options.html&&a.options.iconSize[0]===b.options.iconSize[0]&&a.options.iconSize[1]===b.options.iconSize[1]&&a.options.iconAnchor[0]===b.options.iconAnchor[0]&&a.options.iconAnchor[1]===b.options.iconAnchor[1]:!1}},Icon:{is:function(a){return a instanceof L.Icon},equal:function(a,b){return this.is(a)&&this.is(b)?a.options.iconUrl===b.options.iconUrl&&a.options.iconRetinaUrl===b.options.iconRetinaUrl&&a.options.iconSize[0]===b.options.iconSize[0]&&a.options.iconSize[1]===b.options.iconSize[1]&&a.options.iconAnchor[0]===b.options.iconAnchor[0]&&a.options.iconAnchor[1]===b.options.iconAnchor[1]&&a.options.shadowUrl===b.options.shadowUrl&&a.options.shadowRetinaUrl===b.options.shadowRetinaUrl&&a.options.shadowSize[0]===b.options.shadowSize[0]&&a.options.shadowSize[1]===b.options.shadowSize[1]&&a.options.shadowAnchor[0]===b.options.shadowAnchor[0]&&a.options.shadowAnchor[1]===b.options.shadowAnchor[1]&&a.options.popupAnchor[0]===b.options.popupAnchor[0]&&a.options.popupAnchor[1]===b.options.popupAnchor[1]:!1}}}};angular.module("leaflet-directive",[]).directive("leaflet",["$http","$log","$parse","$rootScope",function(b,c){return{restrict:"E",replace:!0,transclude:!0,scope:{center:"=center",defaults:"=defaults",maxBounds:"=maxbounds",bounds:"=bounds",marker:"=marker",markers:"=markers",legend:"=legend",geojson:"=geojson",paths:"=paths",tiles:"=tiles",events:"=events",layers:"=layers",customControls:"=customControls",leafletMap:"=leafletmap",eventBroadcast:"=eventBroadcast"},template:'<div class="angular-leaflet-map" ng-transclude></div>',controller:["$scope",function(a){this.getMap=function(){return a.map}}],link:function(b,d,e){function f(b,c){b.zoomControl&&a(c.zoomControlPosition)&&b.zoomControl.setPosition(c.zoomControlPosition),b.zoomControl&&a(c.zoomControl)&&c.zoomControl===!1&&b.zoomControl.removeFrom(b),b.zoomsliderControl&&a(c.zoomsliderControl)&&c.zoomsliderControl===!1&&b.zoomsliderControl.removeFrom(b)}var g=h(b.defaults);b.maxBounds&&(g.minZoom=void 0),e.width&&(isNaN(e.width)?d.css("width",e.width):d.css("width",e.width+"px")),e.height&&(isNaN(e.height)?d.css("height",e.height):d.css("height",e.height+"px")),b.$on("leafletDirectiveSetMap",function(a,b){var c=b.shift();i[c].apply(i,b)});var i=new L.Map(d[0],{maxZoom:g.maxZoom,minZoom:g.minZoom,doubleClickZoom:g.doubleClickZoom,scrollWheelZoom:g.scrollWheelZoom,attributionControl:g.attributionControl});if(b.map=i,a(e.center)||(c.warn("[AngularJS - Leaflet] 'center' is undefined in the current scope, did you forget to initialize it?"),i.setView([g.center.lat,g.center.lng],g.center.zoom)),!a(e.tiles)&&!a(e.layers)){var j=g.tileLayer,k=g.tileLayerOptions,l=L.tileLayer(j,k);l.addTo(i)}f(i,g)}}}]),angular.module("leaflet-directive").directive("center",["$http","$log","$parse","$rootScope",function(c,d,f){return{restrict:"A",scope:!1,replace:!1,transclude:!1,require:"leaflet",link:function(c,i,j,k){function l(a){if(c.bounds){var b=a.getBounds(),d=b.getSouthWest(),e=b.getNorthEast();c.bounds={southWest:{lat:d.lat,lng:d.lng},northEast:{lat:e.lat,lng:e.lng}}}}function m(a,b){a.setView([b.lat,b.lng],b.zoom),l(a)}function n(c){return a(c)&&b(c.lat)&&b(c.lng)&&b(c.zoom)}function o(a,h,i){b(h.lat)&&b(h.lng)&&b(h.zoom)?m(a,h):h.autoDiscover===!0?a.locate({setView:!0,maxZoom:i.maxZoom}):(d.warn("[AngularJS - Leaflet] 'center' is incorrect"),m(a,i.center));var j={lat:f("center.lat"),lng:f("center.lng"),zoom:f("center.zoom")},k=!1;c.$watch("center",function(b,c){return n(b)?(k||e(b,c)||m(a,b),void 0):(d.warn("[AngularJS - Leaflet] invalid 'center'"),m(a,i.center),void 0)},!0),a.on("movestart",function(){k=!0}),a.on("moveend",function(){k=!1,g(c,function(b){j&&(j.lat.assign(b,a.getCenter().lat),j.lng.assign(b,a.getCenter().lng),j.zoom.assign(b,a.getZoom())),b.$emit("centerUpdated")})})}var p=h(c.defaults),q=k.getMap(),r=c.center;o(q,r,p)}}}]),angular.module("leaflet-directive").directive("tiles",["$http","$log","$parse","$rootScope",function(){return{restrict:"A",scope:!1,replace:!1,transclude:!1,require:"leaflet",link:function(a,b,c,d){function e(b,c,d){var e,f=d.tileLayer,g=d.tileLayerOptions;angular.isDefined(c.url)&&(f=c.url),angular.isDefined(c.options)&&angular.copy(c.options,g),a.$watch("tiles.url",function(a){angular.isDefined(a)&&e.setUrl(a)}),e=L.tileLayer(f,g),e.addTo(b)}var f=h(a.defaults),g=d.getMap(),i=a.tiles;e(g,i,f)}}}]),angular.module("leaflet-directive").directive("legend",["$http","$log","$parse","$rootScope",function(a,b){return{restrict:"A",scope:!1,replace:!1,transclude:!1,require:"leaflet",link:function(a,c,e,f){function g(a,c){if(d(c.colors)&&d(c.labels)&&c.colors.length===c.labels.length){var e=c.legendClass?c.legendClass:"legend",f=c.position||"bottomright",g=L.control({position:f});g.onAdd=function(){for(var a=L.DomUtil.create("div",e),b=0;b<c.colors.length;b++)a.innerHTML+='<div><i style="background:'+c.colors[b]+'"></i>'+c.labels[b]+"</div>";return a},g.addTo(a)}else b.warn("[AngularJS - Leaflet] legend.colors and legend.labels must be set.")}var h=f.getMap(),i=a.legend;g(h,i)}}}]),angular.module("leaflet-directive").directive("geojson",["$http","$log","$parse","$rootScope",function(b,c,d,e){return{restrict:"A",scope:!1,replace:!1,transclude:!1,require:"leaflet",link:function(b,c,d,f){function h(c){b.$watch("geojson",function(d){if(a(d)&&(a(i)&&c.removeLayer(b.leaflet.geojson),a(d.data))){var f=d.resetStyleOnMouseout;i=L.geoJson(d.data,{style:d.style,onEachFeature:function(a,c){c.on({mouseover:function(c){g(b,function(){d.selected=a,e.$broadcast("leafletDirectiveMap.geojsonMouseover",c)})},mouseout:function(a){f&&i.resetStyle(a.target),g(b,function(){d.selected=void 0,e.$broadcast("leafletDirectiveMap.geojsonMouseout",a)})},click:function(a){g(b,function(){e.$broadcast("leafletDirectiveMap.geojsonClick",d.selected,a)})}})}}).addTo(c)}})}var i,j=f.getMap();h(j)}}}]),angular.module("leaflet-directive").directive("layers",["$http","$log","$parse","$rootScope",function(b,d){return{restrict:"A",scope:!1,replace:!1,transclude:!1,require:"leaflet",link:function(b,e,f,g){function i(c,e,f){if(a(e)){if(!a(e.baselayers)||Object.keys(b.layers.baselayers).length<=0)return d.error("[AngularJS - Leaflet] At least one baselayer has to be defined"),void 0;var g={};g.baselayers={},g.controls={},g.controls.layers=new L.control.layers,g.controls.layers.setPosition(f.controlLayersPosition),g.controls.layers.addTo(c);var h=!1;for(var i in e.baselayers){var j=k(e.baselayers[i]);null!==j&&(g.baselayers[i]=j,e.baselayers[i].top===!0&&(c.addLayer(g.baselayers[i]),h=!0),g.controls.layers.addBaseLayer(g.baselayers[i],e.baselayers[i].name))}!h&&Object.keys(g.baselayers).length>0&&c.addLayer(g.baselayers[Object.keys(e.baselayers)[0]]),g.overlays={};for(i in e.overlays){var l=k(e.overlays[i]);null!==l&&(g.overlays[i]=l,e.overlays[i].visible===!0&&c.addLayer(g.overlays[i]),g.controls.layers.addOverlay(g.overlays[i],e.overlays[i].name))}b.$watch("layers.baselayers",function(a){for(var b in g.baselayers)void 0===a[b]&&(g.controls.layers.removeLayer(g.baselayers[b]),c.hasLayer(g.baselayers[b])&&c.removeLayer(g.baselayers[b]),delete g.baselayers[b]);for(var f in a)if(void 0===g.baselayers[f]){var h=k(a[f]);null!==h&&(g.baselayers[f]=h,a[f].top===!0&&c.addLayer(g.baselayers[f]),g.controls.layers.addBaseLayer(g.baselayers[f],a[f].name))}if(Object.keys(g.baselayers).length<=0)d.error("[AngularJS - Leaflet] At least one baselayer has to be defined");else{var i=!1;for(var j in g.baselayers)if(c.hasLayer(g.baselayers[j])){i=!0;break}i||c.addLayer(g.baselayers[Object.keys(e.baselayers)[0]])}},!0),b.$watch("layers.overlays",function(a){for(var b in g.overlays)void 0===a[b]&&(g.controls.layers.removeLayer(g.overlays[b]),c.hasLayer(g.overlays[b])&&c.removeLayer(g.overlays[b]),delete g.overlays[b]);for(var d in a)if(void 0===g.overlays[d]){var e=k(a[d]);null!==e&&(g.overlays[d]=e,g.controls.layers.addOverlay(g.overlays[d],a[d].name),a[d].visible===!0&&c.addLayer(g.overlays[d]))}},!0)}}function k(a){if(!c(a.type))return d.error("[AngularJS - Leaflet] A base layer must have a type"),null;if("xyz"!==a.type&&"wms"!==a.type&&"group"!==a.type&&"markercluster"!==a.type&&"google"!==a.type&&"bing"!==a.type)return d.error('[AngularJS - Leaflet] A layer must have a valid type: "xyz, wms, group, google"'),null;if(("xyz"===a.type||"wms"===a.type)&&!c(a.url))return d.error("[AngularJS - Leaflet] A base layer must have an url"),null;if(!c(a.name))return d.error("[AngularJS - Leaflet] A base layer must have a name"),null;(void 0===a.layerParams||null===a.layerParams||"object"!=typeof a.layerParams)&&(a.layerParams={}),(void 0===a.layerOptions||null===a.layerOptions||"object"!=typeof a.layerOptions)&&(a.layerOptions={});var b=null;for(var e in a.layerParams)a.layerOptions[e]=a.layerParams[e];switch(a.type){case"xyz":b=l(a.url,a.layerOptions);break;case"wms":b=m(a.url,a.layerOptions);break;case"group":b=n();break;case"markercluster":b=o(a.layerOptions);break;case"google":b=p(a.layerType,a.layerOptions);break;case"bing":b=q(a.bingKey,a.layerOptions);break;default:b=null}return b}function l(a,b){var c=L.tileLayer(a,b);return c}function m(a,b){var c=L.tileLayer.wms(a,b);return c}function n(){var a=L.layerGroup();return a}function o(a){if(j.MarkerClusterPlugin.isLoaded()){var b=new L.MarkerClusterGroup(a);return b}return null}function p(a,b){if(a=a||"SATELLITE",j.GoogleLayerPlugin.isLoaded()){var c=new L.Google(a,b);return c}return null}function q(a,b){if(j.BingLayerPlugin.isLoaded()){var c=new L.BingLayer(a,b);return c}return null}var r=h(b.defaults),s=g.getMap(),t=b.layers;i(s,t,r)}}}]),angular.module("leaflet-directive").directive("bounds",["$http","$log","$parse","$rootScope",function(c,d){return{restrict:"A",scope:!1,replace:!1,transclude:!1,require:"leaflet",link:function(c,e,f,g){function h(c){return a(c)&&a(c.southWest)&&a(c.northEast)&&b(c.southWest.lat)&&b(c.southWest.lng)&&b(c.northEast.lat)&&b(c.northEast.lng)}function i(b){c.$watch("bounds",function(c){if(!a(c)||!h(c))return d.error("[AngularJS - Leaflet] Invalid bounds"),void 0;var e=c.southWest,f=c.northEast,g=new L.LatLngBounds(new L.LatLng(e.lat,e.lng),new L.LatLng(f.lat,f.lng));b.getBounds().equals(g)||b.fitBounds(g)},!0)}var j=g.getMap();i(j)}}}]),angular.module("leaflet-directive").directive("events",["$http","$log","$parse","$rootScope",function(a,b,c,d){return{restrict:"A",scope:!1,replace:!1,transclude:!1,require:"leaflet",link:function(a,c,e,f){function h(){function c(b,c){return function(e){var f="leafletDirectiveMap."+b;g(a,function(a){"emit"===c?a.$emit(f,{leafletEvent:e}):"broadcast"===c&&d.$broadcast(f,{leafletEvent:e})})}}var e,f,h=["click","dblclick","mousedown","mouseup","mouseover","mouseout","mousemove","contextmenu","focus","blur","preclick","load","unload","viewreset","movestart","move","moveend","dragstart","drag","dragend","zoomstart","zoomend","zoomlevelschange","resize","autopanstart","layeradd","layerremove","baselayerchange","overlayadd","overlayremove","locationfound","locationerror","popupopen","popupclose"],i=[],k="broadcast";if(void 0===a.eventBroadcast||null===a.eventBroadcast)i=h;else if("object"!=typeof a.eventBroadcast)b.warn("[AngularJS - Leaflet] event-broadcast must be an object check your model.");else if(void 0===a.eventBroadcast.map||null===a.eventBroadcast.map)i=h;else if("object"!=typeof a.eventBroadcast.map)b.warn("[AngularJS - Leaflet] event-broadcast.map must be an object check your model.");else{void 0!==a.eventBroadcast.map.logic&&null!==a.eventBroadcast.map.logic&&("emit"!==a.eventBroadcast.map.logic&&"broadcast"!==a.eventBroadcast.map.logic?b.warn("[AngularJS - Leaflet] Available event propagation logic are: 'emit' or 'broadcast'."):"emit"===a.eventBroadcast.map.logic&&(k="emit"));var l=!1,m=!1;if(void 0!==a.eventBroadcast.map.enable&&null!==a.eventBroadcast.map.enable&&"object"==typeof a.eventBroadcast.map.enable&&(l=!0),void 0!==a.eventBroadcast.map.disable&&null!==a.eventBroadcast.map.disable&&"object"==typeof a.eventBroadcast.map.disable&&(m=!0),l&&m)b.warn("[AngularJS - Leaflet] can not enable and disable events at the time");else if(l||m)if(l)for(e=0;e<a.eventBroadcast.map.enable.length;e++)f=a.eventBroadcast.map.enable[e],-1!==i.indexOf(f)?b.warn("[AngularJS - Leaflet] This event "+f+" is already enabled"):-1===h.indexOf(f)?b.warn("[AngularJS - Leaflet] This event "+f+" does not exist"):i.push(f);else for(i=h,e=0;e<a.eventBroadcast.map.disable.length;e++){f=a.eventBroadcast.map.disable[e];var n=i.indexOf(f);-1===n?b.warn("[AngularJS - Leaflet] This event "+f+" does not exist or has been already disabled"):i.splice(n,1)}else b.warn("[AngularJS - Leaflet] must enable or disable events")}for(e=0;e<i.length;e++)f=i[e],j.on(f,c(f,k),{eventName:f})}function i(){if("object"!=typeof a.events)return!1;for(var b in a.events)j.on(b,a.events[b])}var j=f.getMap();a.legend,i(),h()}}}])}();