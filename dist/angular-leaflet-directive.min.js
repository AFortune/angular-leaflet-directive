/**!
 * The MIT License
 *
 * Copyright (c) 2013 the angular-leaflet-directive Team, http://tombatossals.github.io/angular-leaflet-directive
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 *
 * angular-google-maps
 * https://github.com/tombatossals/angular-leaflet-directive
 *
 * @authors https://github.com/tombatossals/angular-leaflet-directive/graphs/contributors
 */

/*! angular-leaflet-directive 14-11-2013 */
!function(){"use strict";angular.module("leaflet-directive",[]).directive("leaflet",["$log","$q","leafletData","leafletMapDefaults","leafletHelpers",function(a,b,c,d,e){return{restrict:"E",replace:!0,transclude:!0,scope:{center:"=center",defaults:"=defaults",maxBounds:"=maxbounds",bounds:"=bounds",marker:"=marker",markers:"=markers",legend:"=legend",geojson:"=geojson",paths:"=paths",tiles:"=tiles",layers:"=layers",controls:"=controls",eventBroadcast:"=eventBroadcast"},template:'<div class="angular-leaflet-map" ng-transclude></div>',controller:["$scope",function(a){a.leafletMap=b.defer(),this.getMap=function(){return a.leafletMap.promise}}],link:function(b,f,g){var h=e.isDefined,i=d(b.defaults);c.setDefaults(i),h(b.maxBounds)&&(i.minZoom=void 0),h(g.width)&&(isNaN(g.width)?f.css("width",g.width):f.css("width",g.width+"px")),h(g.height)&&(isNaN(g.height)?f.css("height",g.height):f.css("height",g.height+"px")),h(g.marker)&&a.warn("[AngularJS - Leaflet] The 'marker' property is currently deprecated, please use the 'markers' property instead.");var j=new L.Map(f[0],{maxZoom:i.maxZoom,minZoom:i.minZoom,keyboard:i.keyboard,dragging:i.dragging,zoomControl:i.zoomControl,doubleClickZoom:i.doubleClickZoom,scrollWheelZoom:i.scrollWheelZoom,attributionControl:i.attributionControl});if(b.leafletMap.resolve(j),c.setMap(j,g.id),h(g.center)||(a.warn("[AngularJS - Leaflet] 'center' is undefined in the current scope, did you forget to initialize it?"),j.setView([i.center.lat,i.center.lng],i.center.zoom)),!(h(g.tiles)||h(g.layers)&&h(b.layers.baselayers))){var k=L.tileLayer(i.tileLayer,i.tileLayerOptions);k.addTo(j),c.setTiles(k)}h(j.zoomControl)&&h(i.zoomControlPosition)&&j.zoomControl.setPosition(i.zoomControlPosition)}}}]),angular.module("leaflet-directive").directive("center",["$log","$parse","leafletMapDefaults","leafletHelpers",function(a,b,c,d){return{restrict:"A",scope:!1,replace:!1,transclude:!1,require:"leaflet",link:function(e,f,g,h){var i=d.isDefined,j=d.isNumber,k=d.safeApply,l=c(e.defaults),m=e.center,n=e.bounds;h.getMap().then(function(c){function d(a){if(n){var b=a.getBounds(),c=b.getSouthWest(),d=b.getNorthEast();n={southWest:{lat:c.lat,lng:c.lng},northEast:{lat:d.lat,lng:d.lng}}}}function f(a,b){a.setView([b.lat,b.lng],b.zoom),d(a)}function g(a){return i(a)&&j(a.lat)&&j(a.lng)&&j(a.zoom)}if(i(m)){m.autoDiscover===!0&&c.locate({setView:!0,maxZoom:l.maxZoom});var h={lat:b("center.lat"),lng:b("center.lng"),zoom:b("center.zoom")}}else a.warn("[AngularJS - Leaflet] 'center' is undefined in the current scope, did you forget to initialize it?"),c.setView([l.center.lat,l.center.lng],l.center.zoom);var o=!1;e.$watch("center",function(b){return g(b)?(o||f(c,b),void 0):(a.warn("[AngularJS - Leaflet] invalid 'center'"),f(c,l.center),void 0)},!0),c.on("movestart",function(){o=!0}),c.on("moveend",function(){o=!1,k(e,function(a){h&&(h.lat.assign(a,c.getCenter().lat),h.lng.assign(a,c.getCenter().lng),h.zoom.assign(a,c.getZoom())),a.$emit("centerUpdated")})})})}}}]),angular.module("leaflet-directive").directive("tiles",["$log","leafletData","leafletMapDefaults","leafletHelpers",function(a,b,c,d){return{restrict:"A",scope:!1,replace:!1,transclude:!1,require:"leaflet",link:function(e,f,g,h){var i=(d.isDefined,c(e.defaults)),j=e.tiles;h.getMap().then(function(c){var d,f=i.tileLayer,h=i.tileLayerOptions;angular.isDefined(j)&&angular.isDefined(j.url)?(f=j.url,e.$watch("tiles.url",function(a){angular.isDefined(a)&&d.setUrl(a)})):a.warn("[AngularJS - Leaflet] The 'tiles' definition doesn't have the 'url' property."),angular.isDefined(j)&&angular.isDefined(j.options)&&angular.copy(j.options,h),d=L.tileLayer(f,h),d.addTo(c),b.setTiles(d,g.id)})}}}]),angular.module("leaflet-directive").directive("legend",["$log","leafletHelpers",function(a,b){return{restrict:"A",scope:!1,replace:!1,transclude:!1,require:"leaflet",link:function(c,d,e,f){var g=b.isArray;f.getMap().then(function(b){var d=c.legend;if(g(d.colors)&&g(d.labels)&&d.colors.length===d.labels.length){var e=d.legendClass?d.legendClass:"legend",f=d.position||"bottomright",h=L.control({position:f});h.onAdd=function(){for(var a=L.DomUtil.create("div",e),b=0;b<d.colors.length;b++)a.innerHTML+='<div><i style="background:'+d.colors[b]+'"></i>'+d.labels[b]+"</div>";return a},h.addTo(b)}else a.warn("[AngularJS - Leaflet] legend.colors and legend.labels must be set.")})}}}]),angular.module("leaflet-directive").directive("geojson",["$log","$rootScope","leafletData","leafletHelpers",function(a,b,c,d){return{restrict:"A",scope:!1,replace:!1,transclude:!1,require:"leaflet",link:function(a,e,f,g){var h=d.safeApply,i=d.isDefined,j=(g.getMap(),{});g.getMap().then(function(d){a.$watch("geojson",function(e){if(i(e)&&(i(j)&&d.removeLayer(j),i(e.data))){var f=e.resetStyleOnMouseout,g=function(c,d){d.on({mouseover:function(d){h(a,function(){e.selected=c,b.$broadcast("leafletDirectiveMap.geojsonMouseover",d)})},mouseout:function(c){f&&j.resetStyle(c.target),h(a,function(){e.selected=void 0,b.$broadcast("leafletDirectiveMap.geojsonMouseout",c)})},click:function(c){h(a,function(){b.$broadcast("leafletDirectiveMap.geojsonClick",e.selected,c)})}})};i(e.options)?i(e.options.onEachFeature)||(e.options.onEachFeature=g):e.options={style:e.style,onEachFeature:g},j=L.geoJson(e.data,e.options),c.setGeoJSON(j),j.addTo(d)}})})}}}]),angular.module("leaflet-directive").directive("layers",["$log","$q","leafletData","leafletHelpers","leafletMapDefaults",function(a,b,c,d,e){return{restrict:"A",scope:!1,replace:!1,transclude:!1,require:"leaflet",controller:["$scope",function(a){a.leafletLayers=b.defer(),this.getLayers=function(){return a.leafletLayers.promise}}],link:function(b,f,g,h){var i=e(b.defaults),j=b.layers,k=d,l=d.isDefined,m=d.isString,n={};h.getMap().then(function(d){function e(b){if(!m(b.type))return a.error("[AngularJS - Leaflet] A base layer must have a type"),null;if("xyz"!==b.type&&"wms"!==b.type&&"group"!==b.type&&"markercluster"!==b.type&&"google"!==b.type&&"bing"!==b.type)return a.error('[AngularJS - Leaflet] A layer must have a valid type: "xyz, wms, group, google"'),null;if(("xyz"===b.type||"wms"===b.type)&&!m(b.url))return a.error("[AngularJS - Leaflet] A base layer must have an url"),null;if(!m(b.name))return a.error("[AngularJS - Leaflet] A base layer must have a name"),null;(void 0===b.layerParams||null===b.layerParams||"object"!=typeof b.layerParams)&&(b.layerParams={}),(void 0===b.layerOptions||null===b.layerOptions||"object"!=typeof b.layerOptions)&&(b.layerOptions={});var c=null;for(var d in b.layerParams)b.layerOptions[d]=b.layerParams[d];switch(b.type){case"xyz":c=f(b.url,b.layerOptions);break;case"wms":c=h(b.url,b.layerOptions);break;case"group":c=o();break;case"markercluster":c=p(b.layerOptions);break;case"google":c=q(b.layerType,b.layerOptions);break;case"bing":c=r(b.bingKey,b.layerOptions);break;default:c=null}return c}function f(a,b){var c=L.tileLayer(a,b);return c}function h(a,b){var c=L.tileLayer.wms(a,b);return c}function o(){var a=L.layerGroup();return a}function p(a){if(k.MarkerClusterPlugin.isLoaded()){var b=new L.MarkerClusterGroup(a);return b}return null}function q(a,b){if(a=a||"SATELLITE",k.GoogleLayerPlugin.isLoaded()){var c=new L.Google(a,b);return c}return null}function r(a,b){if(k.BingLayerPlugin.isLoaded()){var c=new L.BingLayer(a,b);return c}return null}if(l(j)){if(!l(j.baselayers)||Object.keys(b.layers.baselayers).length<=0)return a.error("[AngularJS - Leaflet] At least one baselayer has to be defined"),void 0;b.leafletLayers.resolve(n),c.setLayers(n,g.id),n.baselayers={},n.controls={},n.controls.layers=new L.control.layers,n.controls.layers.setPosition(i.controlLayersPosition),n.controls.layers.addTo(d);var s=!1;for(var t in j.baselayers){var u=e(j.baselayers[t]);null!==u&&(n.baselayers[t]=u,j.baselayers[t].top===!0&&(d.addLayer(n.baselayers[t]),s=!0),n.controls.layers.addBaseLayer(n.baselayers[t],j.baselayers[t].name))}!s&&Object.keys(n.baselayers).length>0&&d.addLayer(n.baselayers[Object.keys(j.baselayers)[0]]),n.overlays={};for(t in j.overlays){var v=e(j.overlays[t]);null!==v&&(n.overlays[t]=v,j.overlays[t].visible===!0&&d.addLayer(n.overlays[t]),n.controls.layers.addOverlay(n.overlays[t],j.overlays[t].name))}b.$watch("layers.baselayers",function(b){for(var c in n.baselayers)void 0===b[c]&&(n.controls.layers.removeLayer(n.baselayers[c]),d.hasLayer(n.baselayers[c])&&d.removeLayer(n.baselayers[c]),delete n.baselayers[c]);for(var f in b)if(void 0===n.baselayers[f]){var g=e(b[f]);null!==g&&(n.baselayers[f]=g,b[f].top===!0&&d.addLayer(n.baselayers[f]),n.controls.layers.addBaseLayer(n.baselayers[f],b[f].name))}if(Object.keys(n.baselayers).length<=0)a.error("[AngularJS - Leaflet] At least one baselayer has to be defined");else{var h=!1;for(var i in n.baselayers)if(d.hasLayer(n.baselayers[i])){h=!0;break}h||d.addLayer(n.baselayers[Object.keys(j.baselayers)[0]])}},!0),b.$watch("layers.overlays",function(a){for(var b in n.overlays)void 0===a[b]&&(n.controls.layers.removeLayer(n.overlays[b]),d.hasLayer(n.overlays[b])&&d.removeLayer(n.overlays[b]),delete n.overlays[b]);for(var c in a)if(void 0===n.overlays[c]){var f=e(a[c]);null!==f&&(n.overlays[c]=f,n.controls.layers.addOverlay(n.overlays[c],a[c].name),a[c].visible===!0&&d.addLayer(n.overlays[c]))}},!0)}})}}}]),angular.module("leaflet-directive").directive("bounds",["$log","leafletHelpers",function(a,b){return{restrict:"A",scope:!1,replace:!1,transclude:!1,require:"leaflet",link:function(c,d,e,f){var g=b.isDefined,h=b.isNumber;f.getMap().then(function(b){function d(a){return g(a)&&g(a.southWest)&&g(a.northEast)&&h(a.southWest.lat)&&h(a.southWest.lng)&&h(a.northEast.lat)&&h(a.northEast.lng)}function e(b){c.$watch("bounds",function(c){if(!g(c)||!d(c))return a.error("[AngularJS - Leaflet] Invalid bounds"),void 0;var e=c.southWest,f=c.northEast,h=new L.LatLngBounds(new L.LatLng(e.lat,e.lng),new L.LatLng(f.lat,f.lng));b.getBounds().equals(h)||b.fitBounds(h)},!0)}e(b)})}}}]),angular.module("leaflet-directive").directive("markers",["$log","$rootScope","$q","leafletData","leafletHelpers","leafletMapDefaults",function(a,b,c,d,e,f){return{restrict:"A",scope:!1,replace:!1,transclude:!1,require:["leaflet","?layers"],link:function(g,h,i,j){var k=f(g.defaults),l=j[0],m=e,n=e.isDefined,o=e.isDefinedAndNotNull,p=e.isString,q=e.isNumber,r=e.safeApply;l.getMap().then(function(e){var f,h=g.markers,l={},s={};f=n(j[1])?j[1].getLayers:function(){var a=c.defer();return a.resolve(),a.promise};var t=L.Icon.extend({options:{iconUrl:k.icon.url,iconRetinaUrl:k.icon.retinaUrl,iconSize:k.icon.size,iconAnchor:k.icon.anchor,labelAnchor:k.icon.labelAnchor,popupAnchor:k.icon.popup,shadowUrl:k.icon.shadow.url,shadowRetinaUrl:k.icon.shadow.retinaUrl,shadowSize:k.icon.shadow.size,shadowAnchor:k.icon.shadow.anchor}});n(h)&&f().then(function(c){function f(d,e,f){function i(a,c){return function(f){var h="leafletDirectiveMarker."+a,i=d.replace("markers.","");"click"===a?r(g,function(){b.$broadcast("leafletDirectiveMarkersClick",i)}):"dragend"===a&&(r(g,function(){e.lat=j.getLatLng().lat,e.lng=j.getLatLng().lng}),e.message&&e.focus===!0&&j.openPopup()),r(g,function(a){"emit"===c?a.$emit(h,{markerName:i,leafletEvent:f}):b.$broadcast(h,{markerName:i,leafletEvent:f})})}}var j=h(e);if(n(e.layer)){if(!p(e.layer))return a.error("[AngularJS - Leaflet] A layername must be a string"),null;if(!o(c))return a.error("[AngularJS - Leaflet] You must add layers to the directive if used in a marker"),null;if(!o(c.overlays))return a.error("[AngularJS - Leaflet] You must add layers overlays to the directive if used in a marker"),null;if(!o(c.overlays[e.layer]))return a.error("[AngularJS - Leaflet] You must use a name of an existing layer"),null;var k=c.overlays[e.layer];if(!(k instanceof L.LayerGroup))return a.error('[AngularJS - Leaflet] A marker can only be added to a layer of type "group"'),null;k.addLayer(j),f.hasLayer(j)&&e.focus===!0&&j.openPopup()}else n(e.group)?(n(s[e.group])||(s[e.group]=L.markerClusterGroup({spiderfyOnMaxZoom:!1,showCoverageOnHover:!1,zoomToBoundsOnClick:!1}),f.addLayer(s[e.group])),s[e.group].addLayer(j)):f.addLayer(j),n(L.Label)&&n(e.label)&&n(e.label.options)&&e.label.options.noHide===!0&&j.showLabel(),e.focus===!0&&j.openPopup();var l,u,v=["click","dblclick","mousedown","mouseover","mouseout","contextmenu","dragstart","drag","dragend","move","remove","popupopen","popupclose"],w=[],x="broadcast";if(void 0===g.eventBroadcast||null===g.eventBroadcast)w=v;else if("object"!=typeof g.eventBroadcast)a.warn("[AngularJS - Leaflet] event-broadcast must be an object check your model.");else if(void 0===g.eventBroadcast.marker||null===g.eventBroadcast.marker)w=v;else if("object"!=typeof g.eventBroadcast.marker)a.warn("[AngularJS - Leaflet] event-broadcast.marker must be an object check your model.");else{void 0!==g.eventBroadcast.marker.logic&&null!==g.eventBroadcast.marker.logic&&("emit"!==g.eventBroadcast.marker.logic&&"broadcast"!==g.eventBroadcast.marker.logic?a.warn("[AngularJS - Leaflet] Available event propagation logic are: 'emit' or 'broadcast'."):"emit"===g.eventBroadcast.marker.logic&&(x="emit"));var y=!1,z=!1;if(void 0!==g.eventBroadcast.marker.enable&&null!==g.eventBroadcast.marker.enable&&"object"==typeof g.eventBroadcast.marker.enable&&(y=!0),void 0!==g.eventBroadcast.marker.disable&&null!==g.eventBroadcast.marker.disable&&"object"==typeof g.eventBroadcast.marker.disable&&(z=!0),y&&z)a.warn("[AngularJS - Leaflet] can not enable and disable events at the same time");else if(y||z)if(y)for(l=0;l<g.eventBroadcast.marker.enable.length;l++)u=g.eventBroadcast.marker.enable[l],-1!==w.indexOf(u)?a.warn("[AngularJS - Leaflet] This event "+u+" is already enabled"):-1===v.indexOf(u)?a.warn("[AngularJS - Leaflet] This event "+u+" does not exist"):w.push(u);else for(w=v,l=0;l<g.eventBroadcast.marker.disable.length;l++){u=g.eventBroadcast.marker.disable[l];var A=w.indexOf(u);-1===A?a.warn("[AngularJS - Leaflet] This event "+u+" does not exist or has been already disabled"):w.splice(A,1)}else a.warn("[AngularJS - Leaflet] must enable or disable events")}for(l=0;l<w.length;l++)u=w[l],j.on(u,i(u,x),{eventName:u,scope_watch_name:d});var B=g.$watch(d,function(b,d){if(!o(b)){if(j.closePopup(),o(c)&&n(c.overlays))for(var e in c.overlays)c.overlays[e]instanceof L.LayerGroup&&c.overlays[e].hasLayer(j)&&c.overlays[e].removeLayer(j);return f.removeLayer(j),B(),void 0}if(n(d)){if(p(b.layer)){if(o(d.layer)||d.layer!==b.layer)if("string"==typeof d.layer&&void 0!==c.overlays[d.layer]&&c.overlays[d.layer].hasLayer(j)&&c.overlays[d.layer].removeLayer(j),j.closePopup(),f.hasLayer(j)&&f.removeLayer(j),void 0!==c.overlays[b.layer]){var g=c.overlays[b.layer];g instanceof L.LayerGroup?(g.addLayer(j),f.hasLayer(j)&&b.focus===!0&&j.openPopup()):a.error('[AngularJS - Leaflet] A marker can only be added to a layer of type "group"')}else a.error("[AngularJS - Leaflet] You must use a name of an existing layer")}else p(d.layer)&&(n(c.overlays[d.layer])&&c.overlays[d.layer].hasLayer(j)&&(c.overlays[d.layer].removeLayer(j),j.closePopup()),f.hasLayer(j)||f.addLayer(j));if(void 0===b.draggable||null===b.draggable||b.draggable!==!0?void 0!==d.draggable&&null!==d.draggable&&d.draggable===!0&&j.dragging&&j.dragging.disable():(void 0===d.draggable||null===d.draggable||d.draggable!==!0)&&(j.dragging?j.dragging.enable():L.Handler.MarkerDrag&&(j.dragging=new L.Handler.MarkerDrag(j),j.options.draggable=!0,j.dragging.enable())),void 0===b.icon||null===b.icon||"object"!=typeof b.icon)void 0!==d.icon&&null!==d.icon&&"object"==typeof d.icon&&(j.setIcon(new t),j.closePopup(),j.unbindPopup(),void 0!==b.message&&null!==b.message&&"string"==typeof b.message&&""!==b.message&&j.bindPopup(b.message));else if(void 0===d.icon||null===d.icon||"object"!=typeof d.icon){var h=!1;j.dragging&&(h=j.dragging.enabled()),m.AwesomeMarkersPlugin.is(b.icon)?j.setIcon(b.icon):m.Leaflet.DivIcon.is(b.icon)||m.Leaflet.Icon.is(b.icon)?j.setIcon(b.icon):j.setIcon(new t(b.icon)),h&&j.dragging.enable(),j.closePopup(),j.unbindPopup(),void 0!==b.message&&null!==b.message&&"string"==typeof b.message&&""!==b.message&&j.bindPopup(b.message)}else if(m.AwesomeMarkersPlugin.is(b.icon)){if(!m.AwesomeMarkersPlugin.equal(b.icon,d.icon)){var i=!1;j.dragging&&(i=j.dragging.enabled()),j.setIcon(b.icon),i&&j.dragging.enable(),j.closePopup(),j.unbindPopup(),void 0!==b.message&&null!==b.message&&"string"==typeof b.message&&""!==b.message&&j.bindPopup(b.message)}}else if(m.Leaflet.DivIcon.is(b.icon)){if(!m.Leaflet.DivIcon.equal(b.icon,d.icon)){var k=!1;j.dragging&&(k=j.dragging.enabled()),j.setIcon(b.icon),k&&j.dragging.enable(),j.closePopup(),j.unbindPopup(),void 0!==b.message&&null!==b.message&&"string"==typeof b.message&&""!==b.message&&j.bindPopup(b.message)}}else if(m.Leaflet.Icon.is(b.icon)){if(!m.Leaflet.Icon.equal(b.icon,d.icon)){var l=!1;j.dragging&&(l=j.dragging.enabled()),j.setIcon(b.icon),l&&j.dragging.enable(),j.closePopup(),j.unbindPopup(),void 0!==b.message&&null!==b.message&&"string"==typeof b.message&&""!==b.message&&j.bindPopup(b.message)}}else if(JSON.stringify(b.icon)!==JSON.stringify(d.icon)){var r=!1;j.dragging&&(r=j.dragging.enabled()),j.setIcon(new t(b.icon)),r&&j.dragging.enable(),j.closePopup(),j.unbindPopup(),void 0!==b.message&&null!==b.message&&"string"==typeof b.message&&""!==b.message&&j.bindPopup(b.message)}if(void 0===b.message||null===b.message||"string"!=typeof b.message||""===b.message?void 0!==d.message&&null!==d.message&&"string"==typeof d.message&&""!==d.message&&(j.closePopup(),j.unbindPopup()):void 0===d.message||null===d.message||"string"!=typeof d.message||""===d.message?(j.bindPopup(b.message),b.focus===!0&&j.openPopup()):b.message!==d.message&&j.setPopupContent(b.message),void 0===b.focus||null===b.focus||b.focus!==!0?void 0!==d.focus&&null!==d.focus&&d.focus===!0&&j.closePopup():void 0===d.focus||null===d.focus||d.focus!==!0?j.openPopup():d.focus===!0&&b.focus===!0&&j.openPopup(),q(b.lat)&&q(b.lng)){var s=j.getLatLng();if(s.lat!==b.lat||s.lng!==b.lng){var u=!1;p(b.layer)&&m.MarkerClusterPlugin.is(c.overlays[b.layer])&&(c.overlays[b.layer].removeLayer(j),u=!0),j.setLatLng([b.lat,b.lng]),u&&c.overlays[b.layer].addLayer(j)}}else{if(a.warn("There are problems with lat-lng data, please verify your marker model"),o(c)&&o(c.overlays))for(var v in c.overlays)(c.overlays[v]instanceof L.LayerGroup||m.MarkerClusterPlugin.is(c.overlays[v]))&&c.overlays[v].hasLayer(j)&&c.overlays[v].removeLayer(j);f.removeLayer(j)}}},!0);return j}function h(a){var b=null;b=a.icon?a.icon:new t;var c={icon:b,draggable:a.draggable?!0:!1};a.title&&(c.title=a.title);var d=new L.marker(a,c);return a.message&&d.bindPopup(a.message),n(L.Label)&&n(a.label)&&n(a.label.message)&&d.bindLabel(a.label.message,a.label.options),d}d.setMarkers(l,i.id),g.$watch("markers",function(a){for(var b in l)if(!n(a[b])){if(l[b].closePopup(),o(c)&&n(c.overlays))for(var d in c.overlays)c.overlays[d]instanceof L.LayerGroup&&c.overlays[d].hasLayer(l[b])&&c.overlays[d].removeLayer(l[b]);if(o(s))for(var g in s)s[g].hasLayer(l[b])&&s[g].removeLayer(l[b]);e.removeLayer(l[b]),delete l[b]}for(var h in a)if(!n(l[h])){var i=f("markers."+h,a[h],e);null!==i&&(l[h]=i)}},!0)})})}}}]),angular.module("leaflet-directive").directive("paths",["$log","leafletData","leafletMapDefaults","leafletHelpers",function(a,b,c,d){return{restrict:"A",scope:!1,replace:!1,transclude:!1,require:"leaflet",link:function(a,e,f,g){var h=d.isDefined,i=c(a.defaults),j=a.paths;g.getMap().then(function(c){function d(c,d,g){var i={};b.setPaths(i,f.id),h(c)&&a.$watch("paths",function(a){for(var b in a)h(i[b])||(i[b]=e(b,a[b],d,g));for(var c in i)h(a[c])||delete i[c]},!0)}function e(b,c,d,e){function f(a){if(h(a.latlngs))switch(a.type){default:case"polyline":case"polygon":i.setLatLngs(k(a.latlngs));break;case"multiPolyline":case"multiPolygon":i.setLatLngs(l(a.latlngs));break;case"rectangle":i.setBounds(new L.LatLngBounds(k(a.latlngs)));break;case"circle":case"circleMarker":i.setLatLng(g(a.latlngs)),h(a.radius)&&i.setRadius(a.radius)}h(a.weight)&&i.setStyle({weight:a.weight}),h(a.color)&&i.setStyle({color:a.color}),h(a.opacity)&&i.setStyle({opacity:a.opacity})}var i,j={weight:e.path.weight,color:e.path.color,opacity:e.path.opacity};switch(h(c.stroke)&&(j.stroke=c.stroke),h(c.fill)&&(j.fill=c.fill),h(c.fillColor)&&(j.fillColor=c.fillColor),h(c.fillOpacity)&&(j.fillOpacity=c.fillOpacity),h(c.smoothFactor)&&(j.smoothFactor=c.smoothFactor),h(c.noClip)&&(j.noClip=c.noClip),h(c.type)||(c.type="polyline"),c.type){default:case"polyline":i=new L.Polyline([],j);break;case"multiPolyline":i=new L.multiPolyline([[[0,0],[1,1]]],j);break;case"polygon":i=new L.Polygon([],j);break;case"multiPolygon":i=new L.MultiPolygon([[[0,0],[1,1],[0,1]]],j);break;case"rectangle":i=new L.Rectangle([[0,0],[1,1]],j);break;case"circle":i=new L.Circle([0,0],1,j);break;case"circleMarker":i=new L.CircleMarker([0,0],j)}d.addLayer(i);var m=a.$watch("paths."+b,function(a){return h(a)?(f(a),void 0):(d.removeLayer(i),m(),void 0)},!0);return i}function g(a){return new L.LatLng(a.lat,a.lng)}function k(a){return a.filter(function(a){return!!a.lat&&!!a.lng}).map(function(a){return new L.LatLng(a.lat,a.lng)})}function l(a){return a.map(function(a){return k(a)})}d(j,c,i)})}}}]),angular.module("leaflet-directive").directive("controls",["$log","leafletHelpers",function(a,b){return{restrict:"A",scope:!1,replace:!1,transclude:!1,require:"leaflet",link:function(a,c,d,e){var f=b.isDefined,g=a.controls;e.getMap().then(function(a){if(f(L.Control.Draw)&&f(g.draw)){var b=new L.Control.Draw(g.draw.options);a.addControl(b)}})}}}]),angular.module("leaflet-directive").directive("eventBroadcast",["$log","$rootScope","leafletHelpers",function(a,b,c){return{restrict:"A",scope:!1,replace:!1,transclude:!1,require:"leaflet",link:function(d,e,f,g){var h=c.safeApply,i=c.isDefinedAndNotNull;c.isDefined,g.getMap().then(function(c){function e(a,c){return function(e){var f="leafletDirectiveMap."+a;h(d,function(a){"emit"===c?a.$emit(f,{leafletEvent:e}):"broadcast"===c&&b.$broadcast(f,{leafletEvent:e})})}}var f,g,j=["click","dblclick","mousedown","mouseup","mouseover","mouseout","mousemove","contextmenu","focus","blur","preclick","load","unload","viewreset","movestart","move","moveend","dragstart","drag","dragend","zoomstart","zoomend","zoomlevelschange","resize","autopanstart","layeradd","layerremove","baselayerchange","overlayadd","overlayremove","locationfound","locationerror","popupopen","popupclose"],k=[],l="broadcast";if(i(d.eventBroadcast))if("object"!=typeof d.eventBroadcast)a.warn("[AngularJS - Leaflet] event-broadcast must be an object check your model.");else if(void 0===d.eventBroadcast.map||null===d.eventBroadcast.map)k=j;else if("object"!=typeof d.eventBroadcast.map)a.warn("[AngularJS - Leaflet] event-broadcast.map must be an object check your model.");else{void 0!==d.eventBroadcast.map.logic&&null!==d.eventBroadcast.map.logic&&("emit"!==d.eventBroadcast.map.logic&&"broadcast"!==d.eventBroadcast.map.logic?a.warn("[AngularJS - Leaflet] Available event propagation logic are: 'emit' or 'broadcast'."):"emit"===d.eventBroadcast.map.logic&&(l="emit"));var m=!1,n=!1;if(void 0!==d.eventBroadcast.map.enable&&null!==d.eventBroadcast.map.enable&&"object"==typeof d.eventBroadcast.map.enable&&(m=!0),void 0!==d.eventBroadcast.map.disable&&null!==d.eventBroadcast.map.disable&&"object"==typeof d.eventBroadcast.map.disable&&(n=!0),m&&n)a.warn("[AngularJS - Leaflet] can not enable and disable events at the time");else if(m||n)if(m)for(f=0;f<d.eventBroadcast.map.enable.length;f++)g=d.eventBroadcast.map.enable[f],-1!==k.indexOf(g)?a.warn("[AngularJS - Leaflet] This event "+g+" is already enabled"):-1===j.indexOf(g)?a.warn("[AngularJS - Leaflet] This event "+g+" does not exist"):k.push(g);else for(k=j,f=0;f<d.eventBroadcast.map.disable.length;f++){g=d.eventBroadcast.map.disable[f];var o=k.indexOf(g);-1===o?a.warn("[AngularJS - Leaflet] This event "+g+" does not exist or has been already disabled"):k.splice(o,1)}else a.warn("[AngularJS - Leaflet] must enable or disable events")}else k=j;for(f=0;f<k.length;f++)g=k[f],c.on(g,e(g,l),{eventName:g})})}}}]),angular.module("leaflet-directive").directive("maxbounds",["$log","leafletMapDefaults","leafletHelpers",function(a,b,c){return{restrict:"A",scope:!1,replace:!1,transclude:!1,require:"leaflet",link:function(d,e,f,g){var h=c.isDefined,i=c.isNumber;b(d.defaults),g.getMap().then(function(b){var c=d.maxBounds;h(c)&&h(c.southWest)&&h(c.northEast)?d.$watch("maxBounds",function(a){h(a.southWest)&&h(a.northEast)&&i(a.southWest.lat)&&i(a.southWest.lng)&&i(a.northEast.lat)&&i(a.northEast.lng)&&b.setMaxBounds(new L.LatLngBounds(new L.LatLng(a.southWest.lat,a.southWest.lng),new L.LatLng(a.northEast.lat,a.northEast.lng)))}):a.warn("[AngularJS - Leaflet] 'maxBounds' is defined in the current scope, but not correctly initialized.")})}}}]),angular.module("leaflet-directive").service("leafletData",["$log","$q","leafletHelpers",function(a,b,c){function d(a,c){e(c)||(c="main");var d;return e(a[c])?d=a[c]:(d=b.defer(),a[c]=d),d}var e=c.isDefined,f={main:b.defer()},g={main:b.defer()},h={main:b.defer()},i={main:b.defer()},j={main:b.defer()},k={main:b.defer()},l={};this.setMap=function(a,b){var c=d(f,b);c.resolve(a)},this.getMap=function(a){var b=d(f,a);return b.promise},this.getDefaults=function(){return l},this.setDefaults=function(a){l=a},this.getPaths=function(a){var b=d(i,a);return b.promise},this.setPaths=function(a,b){var c=d(i,b);c.resolve(a)},this.getMarkers=function(a){var b=d(j,a);return b.promise},this.setMarkers=function(a,b){var c=d(j,b);c.resolve(a)},this.getLayers=function(a){var b=d(h,a);return b.promise},this.setLayers=function(a,b){var c=d(h,b);c.resolve(a)},this.setTiles=function(a,b){var c=d(g,b);c.resolve(a)},this.getTiles=function(a){var b=d(g,a);return b.promise},this.setGeoJSON=function(a,b){var c=d(k,b);c.resolve(a)},this.getGeoJSON=function(a){var b=d(k,a);return b.promise}}]),angular.module("leaflet-directive").factory("leafletMapDefaults",["leafletHelpers",function(a){function b(){return{maxZoom:18,minZoom:1,keyboard:!0,dragging:!0,doubleClickZoom:!0,scrollWheelZoom:!0,zoomControl:!0,attributionControl:!0,zoomsliderControl:!1,zoomControlPosition:"topleft",controlLayersPosition:"topright",tileLayer:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",tileLayerOptions:{attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'},icon:{url:"http://cdn.leafletjs.com/leaflet-0.6.4/images/marker-icon.png",retinaUrl:"http://cdn.leafletjs.com/leaflet-0.6.4/images/marker-icon-2x.png",size:[25,41],anchor:[12,40],labelAnchor:[10,-20],popup:[0,-40],shadow:{url:"http://cdn.leafletjs.com/leaflet-0.6.4/images/marker-shadow.png",retinaUrl:"http://cdn.leafletjs.com/leaflet-0.6.4/images/marker-shadow.png",size:[41,41],anchor:[12,40]}},path:{weight:10,opacity:1,color:"#0000ff"},center:{lat:0,lng:0,zoom:1}}}var c=a.isDefined;return function(a){var d=b();return c(a)&&(d.maxZoom=c(a.maxZoom)?parseInt(a.maxZoom,10):d.maxZoom,d.minZoom=c(a.minZoom)?parseInt(a.minZoom,10):d.minZoom,d.doubleClickZoom=c(a.doubleClickZoom)?a.doubleClickZoom:d.doubleClickZoom,d.scrollWheelZoom=c(a.scrollWheelZoom)?a.scrollWheelZoom:d.doubleClickZoom,d.zoomControl=c(a.zoomControl)?a.zoomControl:d.zoomControl,d.attributionControl=c(a.attributionControl)?a.attributionControl:d.attributionControl,d.tileLayer=c(a.tileLayer)?a.tileLayer:d.tileLayer,d.zoomControlPosition=c(a.zoomControlPosition)?a.zoomControlPosition:d.zoomControlPosition,d.keyboard=c(a.keyboard)?a.keyboard:d.keyboard,d.dragging=c(a.dragging)?a.dragging:d.dragging,d.controlLayersPosition=c(a.controlLayersPosition)?a.controlLayersPosition:d.controlLayersPosition,c(a.tileLayerOptions)&&angular.copy(a.tileLayerOptions,d.tileLayerOptions)),d}}]),angular.module("leaflet-directive").factory("leafletHelpers",function(){return{isDefined:function(a){return angular.isDefined(a)},isDefinedAndNotNull:function(a){return angular.isDefined(a)&&null!==a},isNumber:function(a){return angular.isNumber(a)},isString:function(a){return angular.isString(a)},isArray:function(a){return angular.isArray(a)},isObject:function(a){return angular.isObject(a)},equals:function(a,b){return angular.equals(a,b)},safeApply:function(a,b){var c=a.$root.$$phase;"$apply"===c||"$digest"===c?a.$eval(b):a.$apply(b)},AwesomeMarkersPlugin:{isLoaded:function(){return void 0!==L.AwesomeMarkers?void 0!==L.AwesomeMarkers.Icon:!1},is:function(a){return this.isLoaded()?a instanceof L.AwesomeMarkers.Icon:!1},equal:function(a,b){return this.isLoaded?this.is(a)&&this.is(b)?a.options.icon===b.options.icon&&a.options.iconColor===b.options.iconColor&&a.options.color===b.options.color&&a.options.iconSize[0]===b.options.iconSize[0]&&a.options.iconSize[1]===b.options.iconSize[1]&&a.options.iconAnchor[0]===b.options.iconAnchor[0]&&a.options.iconAnchor[1]===b.options.iconAnchor[1]&&a.options.popupAnchor[0]===b.options.popupAnchor[0]&&a.options.popupAnchor[1]===b.options.popupAnchor[1]&&a.options.shadowAnchor[0]===b.options.shadowAnchor[0]&&a.options.shadowAnchor[1]===b.options.shadowAnchor[1]&&a.options.shadowSize[0]===b.options.shadowSize[0]&&a.options.shadowSize[1]===b.options.shadowSize[1]:!1:!1}},MarkerClusterPlugin:{isLoaded:function(){return void 0!==L.MarkerClusterGroup},is:function(a){return this.isLoaded()?a instanceof L.MarkerClusterGroup:!1}},GoogleLayerPlugin:{isLoaded:function(){return void 0!==L.Google},is:function(a){return this.isLoaded()?a instanceof L.Google:!1}},BingLayerPlugin:{isLoaded:function(){return void 0!==L.BingLayer},is:function(a){return this.isLoaded()?a instanceof L.BingLayer:!1}},Leaflet:{DivIcon:{is:function(a){return a instanceof L.DivIcon},equal:function(a,b){return this.is(a)&&this.is(b)?a.options.html===b.options.html&&a.options.iconSize[0]===b.options.iconSize[0]&&a.options.iconSize[1]===b.options.iconSize[1]&&a.options.iconAnchor[0]===b.options.iconAnchor[0]&&a.options.iconAnchor[1]===b.options.iconAnchor[1]:!1}},Icon:{is:function(a){return a instanceof L.Icon},equal:function(a,b){return this.is(a)&&this.is(b)?a.options.iconUrl===b.options.iconUrl&&a.options.iconRetinaUrl===b.options.iconRetinaUrl&&a.options.iconSize[0]===b.options.iconSize[0]&&a.options.iconSize[1]===b.options.iconSize[1]&&a.options.iconAnchor[0]===b.options.iconAnchor[0]&&a.options.iconAnchor[1]===b.options.iconAnchor[1]&&a.options.shadowUrl===b.options.shadowUrl&&a.options.shadowRetinaUrl===b.options.shadowRetinaUrl&&a.options.shadowSize[0]===b.options.shadowSize[0]&&a.options.shadowSize[1]===b.options.shadowSize[1]&&a.options.shadowAnchor[0]===b.options.shadowAnchor[0]&&a.options.shadowAnchor[1]===b.options.shadowAnchor[1]&&a.options.popupAnchor[0]===b.options.popupAnchor[0]&&a.options.popupAnchor[1]===b.options.popupAnchor[1]:!1}}}}})}();