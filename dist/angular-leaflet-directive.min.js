/*! angular-leaflet-directive 27-04-2013 */
var leafletDirective=angular.module("leaflet-directive",[]);leafletDirective.directive("leaflet",function(){return{restrict:"E",replace:!0,transclude:!0,scope:{center:"=center",marker:"=marker",message:"=message",zoom:"=zoom",multiMarkers:"=multimarkers",mainPath:"=mainpath"},template:'<div class="angular-leaflet-map"></div>',link:function(t,n,a){var e=n[0],r=new L.Map(e);L.tileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:12}).addTo(r);var o=new L.LatLng(40.094882122321145,-3.8232421874999996);if(r.setView(o,5),t.$watch("center",function(n){if(void 0!==n){n=new L.LatLng(t.center.lat,t.center.lng);var e=t.zoom||8;r.setView(n,e);var o=new L.marker(t.center,{draggable:a.markcenter?!1:!0});(a.markcenter||a.marker)&&(r.addLayer(o),a.marker&&(t.marker.lat=o.getLatLng().lat,t.marker.lng=o.getLatLng().lng),t.$watch("message",function(t){o.bindPopup("<strong>"+t+"</strong>",{closeButton:!1}),o.openPopup()}));var g=!1;if(r.on("dragstart",function(){g=!0}),r.on("drag",function(){t.$apply(function(t){t.center.lat=r.getCenter().lat,t.center.lng=r.getCenter().lng})}),r.on("dragend",function(){g=!1}),t.$watch("center.lng",function(t){g||r.setView(new L.LatLng(r.getCenter().lat,t),r.getZoom())}),t.$watch("center.lat",function(t){g||r.setView(new L.LatLng(t,r.getCenter().lng),r.getZoom())}),t.$watch("zoom",function(t){r.setZoom(t)}),r.on("zoomend",function(){t.$apply(function(t){t.zoom=r.getZoom()})}),a.marker){var l=!1;(function(){o.on("dragstart",function(){l=!0}),o.on("drag",function(){t.$apply(function(t){t.marker.lat=o.getLatLng().lat,t.marker.lng=o.getLatLng().lng})}),o.on("dragend",function(){o.openPopup(),l=!1}),r.on("click",function(n){o.setLatLng(n.latlng),o.openPopup(),t.$apply(function(t){t.marker.lat=o.getLatLng().lat,t.marker.lng=o.getLatLng().lng})}),t.$watch("marker.lng",function(t){l||o.setLatLng(new L.LatLng(o.getLatLng().lat,t))}),t.$watch("marker.lat",function(t){l||o.setLatLng(new L.LatLng(t,o.getLatLng().lng))})})()}}}),a.multimarkers){var g=[];t.$watch("multiMarkers",function(){for(var n in g)t.multiMarkers[n]||r.removeLayer(g[n]);for(var n in t.multiMarkers)g[n]||function(n){var a=t.multiMarkers[n],e=new L.marker(t.multiMarkers[n],{draggable:a.draggable?!0:!1});e.on("dragstart",function(){dragging_marker=!0}),e.on("drag",function(){t.$apply(function(){a.lat=e.getLatLng().lat,a.lng=e.getLatLng().lng})}),e.on("dragend",function(){dragging_marker=!1}),t.$watch("multiMarkers."+n,function(){e.setLatLng(t.multiMarkers[n])},!0),r.addLayer(e),g[n]=e}(n)},!0)}if(a.mainpath){var l=new L.Polyline([],{});r.addLayer(l),t.$watch("mainPath",function(){l.setLatLngs(t.mainPath.latlngs),l.setStyle({smoothFactor:t.mainPath.smoothFactor,color:t.mainPath.color})},!0)}}}});