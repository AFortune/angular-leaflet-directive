<!DOCTYPE html>
<html ng-app="demoapp">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="../bower_components/angular/angular.min.js"></script>
    <script src="../bower_components/leaflet/dist/leaflet.js"></script>
    <script src="../bower_components/Leaflet.label/dist/leaflet.label.js"></script>
    <script src="../bower_components/Leaflet.awesome-markers/dist/leaflet.awesome-markers.js"></script>
    <script src="../dist/angular-leaflet-directive.js"></script>
    <link rel="stylesheet" href="../bower_components/leaflet/dist/leaflet.css" />
    <link rel="stylesheet" href="../bower_components/Leaflet.label/dist/leaflet.label.css" />
    <link rel="stylesheet" href="../bower_components/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="../bower_components/Leaflet.awesome-markers/dist/leaflet.awesome-markers.css">
    <script>
        var app = angular.module("demoapp", ["leaflet-directive"]);
        app.controller("PathEventsController", [ "$scope", "leafletBoundsHelpers", function($scope, leafletBoundsHelpers) {

            var paths = {};
            var markers = {};
            $scope.clicked = 0;

            var marylandIslands = {
                'Fort Carroll': {
                    lat: 39.214766,
                    lng: -76.519003
                },
                'Gibson Island': {
                    lat: 39.077642,
                    lng: -76.433344
                },
                'Solomons Island': {
                    lat: 38.320145,
                    lng: -76.457334
                }
            };

            var last = {}
            angular.forEach(marylandIslands, function (v, k) {
                markers[k] = {
                    lat: v.lat,
                    lng: v.lng,
                    label: {
                        message: k,
                        direction: 'auto'
                    },
                    icon: {
                        type: 'awesomeMarker',
                        icon: 'fa-star',
                        color: 'blue',
                        prefix: 'fa',
                        shape: 'circle',
                        labelAnchor: [10, -24]
                    },
                    riseOnHover: true
                };

                if (last.name && last.value) {
                    paths[k + '_' + last.name] = {
                        type: 'polyline',
                        weight: 8,
                        color: 'yellow',
                        originalColor: 'yellow',
                        latlngs: [ v, last.value ]
                    };
                }
                last.value = v;
                last.name = k;
            });

            angular.extend($scope, {
                center: {
                    lat:38.976492,
                    lng:-76.49231,
                    zoom: 8
                },
                layers: {
                    baselayers: {
                        xyz: {
                            name: 'OpenStreetMap (XYZ)',
                            url: 'http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
                            type: 'xyz'
                        }
                    }
                },
                events: {
                    path: {
                        enable: [ 'click', 'mouseover', 'mouseout' ]
                    },
                    marker: {
                        enable: [ 'click', 'mouseover' ]
                    }
                },
                paths: paths,
                markers: markers,
                bounds: {}
            });

            $scope.$on('leafletDirectiveMarker.click', function (event, marker) {
                angular.extend($scope.center, {
                    lat: $scope.markers[marker.modelName].lat,
                    lng: $scope.markers[marker.modelName].lng
                })
                $scope.clicked++;
            });

            $scope.$on('leafletDirectivePath.click', function (event, path) {
                var n1 = $scope.markers[path.modelName.split('_')[0]];
                var n2 = $scope.markers[path.modelName.split('_')[1]];
                $scope.bounds = leafletBoundsHelpers.createBoundsFromArray([[n1.lat, n1.lng], [n2.lat, n2.lng]]);
                $scope.clicked++;
            });

            $scope.$on('leafletDirectivePath.mouseover', function (event, path) {
                $scope.paths[path.modelName].color = "white";
                $scope.mouseover = path.modelName + ' path';
            });

            $scope.$on('leafletDirectiveMarker.mouseover', function (event, marker) {
                $scope.markers[marker.modelName].icon = {
                    type: 'awesomeMarker',
                    icon: 'fa-star',
                    color: 'yellow',
                    prefix: 'fa',
                    shape: 'circle',
                    labelAnchor: [10, -24]
                };

                console.log($scope.markers[marker.modelName]);
                $scope.mouseover = marker.modelName + ' marker';
            });

            $scope.$on('leafletDirectivePath.mouseout', function (event, path) {
                $scope.paths[path.modelName].color = $scope.paths[path.modelName].originalColor;
            });

        }]);
    </script>
  </head>
  <body ng-controller="PathEventsController">
    <leaflet center="center" paths="paths" markers="markers" bounds="bounds" layers="layers" event-broadcast="events" paths="paths" width="100%" height="480px"></leaflet>
    <h1>Paths specific events propagation example</h1>
    <p>Click on marker or path points to center map and trigger an event</p>
    <p>Mouse over: <strong ng-bind="mouseover"></strong></p>
    <p>You clicked in paths and markers <b>{{clicked}}</b> times </p>
  </body>
</html>
